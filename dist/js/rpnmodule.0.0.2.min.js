!function(e,t,i,n){var a,s={drag:true,drop:true,exclude:"",nested:true,vertical:true},r={afterMove:function(e,t,i){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(e,t){return true},onCancel:function(e,t,i,n){},onDrag:function(e,t,i,n){e.css(t)},onDragStart:function(t,i,n,a){t.css({height:t.height(),width:t.width()});t.addClass("dragged");e("body").addClass("dragging")},onDrop:function(t,i,n,a){t.removeClass("dragged").removeAttr("style");e("body").removeClass("dragging")},onMousedown:function(e,t,i){if(!i.target.nodeName.match(/^(input|select)$/i)){i.preventDefault();return true}},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(t,i,n){var a=e.extend({},t.data());if(n)return[i];else if(i[0]){a.children=i}delete a.subContainers;delete a.sortable;return a},tolerance:0},o={},l=0,d={left:0,top:0,bottom:0,right:0},a={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},c="subContainers";function u(e,t){var i=Math.max(0,e[0]-t[0],t[0]-e[1]),n=Math.max(0,e[2]-t[1],t[1]-e[3]);return i+n}function h(t,i,n,a){var s=t.length,r=a?"offset":"position";n=n||0;while(s--){var o=t[s].el?t[s].el:e(t[s]),l=o[r]();l.left+=parseInt(o.css("margin-left"),10);l.top+=parseInt(o.css("margin-top"),10);i[s]=[l.left-n,l.left+o.outerWidth()+n,l.top-n,l.top+o.outerHeight()+n]}}function f(e,t){var i=t.offset();return{left:e.left-i.left,top:e.top-i.top}}function p(e,t,i){t=[t.left,t.top];i=i&&[i.left,i.top];var n,a=e.length,s=[];while(a--){n=e[a];s[a]=[a,u(n,t),i&&u(n,i)]}s=s.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]});return s}function v(t){this.options=e.extend({},r,t);this.containers=[];if(!this.options.rootGroup){this.scrollProxy=e.proxy(this.scroll,this);this.dragProxy=e.proxy(this.drag,this);this.dropProxy=e.proxy(this.drop,this);this.placeholder=e(this.options.placeholder);if(!t.isValidTarget)this.options.isValidTarget=n}}v.get=function(e){if(!o[e.group]){if(e.group===n)e.group=l++;o[e.group]=new v(e)}return o[e.group]};v.prototype={dragInit:function(t,i){this.$document=e(i.el[0].ownerDocument);this.item=e(t.target).closest(this.options.itemSelector);this.itemContainer=i;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,r.onMousedown,t)){return}this.setPointer(t);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=true},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,r.onDragStart,e);this.item.before(this.placeholder);this.dragging=true}this.setPointer(e);this.options.onDrag(this.item,f(this.pointer,this.item.offsetParent()),r.onDrag,e);var t=e.pageX||e.originalEvent.pageX,i=e.pageY||e.originalEvent.pageY,n=this.sameResultBox,a=this.options.tolerance;if(!n||n.top-a>i||n.bottom+a<i||n.left-a>t||n.right+a<t)if(!this.searchValidTarget())this.placeholder.detach()},drop:function(e){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();else this.options.onCancel(this.item,this.itemContainer,r.onCancel,e);this.options.onDrop(this.item,this.getContainer(this.item),r.onDrop,e);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=n;this.dragging=false}},searchValidTarget:function(e,t){if(!e){e=this.relativePointer||this.pointer;t=this.lastRelativePointer||this.lastPointer}var i=p(this.getContainerDimensions(),e,t),a=i.length;while(a--){var s=i[a][0],r=i[a][1];if(!r||this.options.pullPlaceholder){var o=this.containers[s];if(!o.disabled){if(!this.$getOffsetParent()){var l=o.getItemOffsetParent();e=f(e,l);t=f(t,l)}if(o.searchValidTarget(e,t))return true}}}if(this.sameResultBox)this.sameResultBox=n},movePlaceholder:function(e,t,i,n){var a=this.lastAppendedItem;if(!n&&a&&a[0]===t[0])return;t[i](this.placeholder);this.lastAppendedItem=t;this.sameResultBox=n;this.options.afterMove(this.placeholder,e,t)},getContainerDimensions:function(){if(!this.containerDimensions)h(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent());return this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(i)},$getOffsetParent:function(){if(this.offsetParent===n){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup){while(e--){if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=false;break}}}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);if(this.$getOffsetParent()){var i=f(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=i}this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(e){var t=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(e){return{left:e.pageX||e.originalEvent.pageX,top:e.pageY||e.originalEvent.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){e.delayMet=true},this.options.delay)}},scroll:function(e){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t){var i=this,n=["drag","drop","scroll"];e.each(n,function(e,n){i.$document[t](a[n],i[n+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=n},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);var t=this.containers.length;while(t--){this.containers[t].traverse(e)}},_clearDimensions:function(){this.containerDimensions=n},_destroy:function(){o[this.options.group]=n}};function g(t,i){this.el=t;this.options=e.extend({},s,i);this.group=v.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var n=this.rootGroup.options.itemPath;this.target=n?this.el.find(n):this.el;this.target.on(a.start,this.handle,e.proxy(this.dragInit,this));if(this.options.drop)this.group.containers.push(this)}g.prototype={dragInit:function(e){var t=this.rootGroup;if(!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)){t.dragInit(e,this)}},isValidDrag:function(e){return e.which==1||e.type=="touchstart"&&e.originalEvent.touches.length==1},searchValidTarget:function(e,t){var i=p(this.getItemDimensions(),e,t),n=i.length,a=this.rootGroup,s=!a.options.isValidTarget||a.options.isValidTarget(a.item,this);if(!n&&s){a.movePlaceholder(this,this.target,"append");return true}else while(n--){var r=i[n][0],o=i[n][1];if(!o&&this.hasChildGroup(r)){var l=this.getContainerGroup(r).searchValidTarget(e,t);if(l)return true}else if(s){this.movePlaceholder(r,e);return true}}},movePlaceholder:function(t,i){var n=e(this.items[t]),a=this.itemDimensions[t],s="after",r=n.outerWidth(),o=n.outerHeight(),l=n.offset(),c={left:l.left,right:l.left+r,top:l.top,bottom:l.top+o};if(this.options.vertical){var u=(a[2]+a[3])/2,h=i.top<=u;if(h){s="before";c.bottom-=o/2}else c.top+=o/2}else{var f=(a[0]+a[1])/2,p=i.left<=f;if(p){s="before";c.right-=r/2}else c.left+=r/2}if(this.hasChildGroup(t))c=d;this.rootGroup.movePlaceholder(this,n,s,c)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();h(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;if(t.css("position")==="relative"||t.css("position")==="absolute"||t.css("position")==="fixed")e=t;else e=t.offsetParent();return e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var a=e.data(this.items[t],c);if(a===n){var s=this.$getChildren(this.items[t],"container");a=false;if(s[0]){var r=e.extend({},this.options,{rootGroup:this.rootGroup,group:l++});a=s[i](r).data(i).group}e.data(this.items[t],c,a)}return a},$getChildren:function(t,i){var n=this.rootGroup.options,a=n[i+"Path"],s=n[i+"Selector"];t=e(t);if(a)t=t.find(a);return t.children(s)},_serialize:function(t,i){var n=this,a=i?"item":"container",s=this.$getChildren(t,a).not(this.options.exclude).map(function(){return n._serialize(e(this),!i)}).get();return this.rootGroup.options.serialize(t,s,i)},traverse:function(t){e.each(this.items||[],function(i){var n=e.data(this,c);if(n)n.traverse(t)});t(this)},_clearDimensions:function(){this.itemDimensions=n},_destroy:function(){var t=this;this.target.off(a.start,this.handle);this.el.removeData(i);if(this.options.drop)this.group.containers=e.grep(this.group.containers,function(e){return e!=t});e.each(this.items||[],function(){e.removeData(this,c)})}};var m={enable:function(){this.traverse(function(e){e.disabled=false})},disable:function(){this.traverse(function(e){e.disabled=true})},serialize:function(){return this._serialize(this.el,true)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};e.extend(g.prototype,m);e.fn[i]=function(t){var a=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),r=s.data(i);if(r&&m[t])return m[t].apply(r,a)||this;else if(!r&&(t===n||typeof t==="object"))s.data(i,new g(s,t));return this})}}(jQuery,window,"sortable");var rpnblackboxmodule=function(){var e;var t;var i;var n;var a;var s;var r;var o=function(e,t,i,n,a,s,r,o,m,b,y,_,x){var C=function(e,t,i,n){switch(e){case"isNumberN":l(t,i,n);break;case"isNumberZ":d(t,i,n);break;case"isNumberD":u(t,i,n);break;case"isNumberQ":c(t,i,n);break;case"isNumber":h(t,i,n);break;case"withComma":f(t);break;case"firstPoint":p(t);break;case"firstComma":v(t);break;case"firstPointComma":g(t);break;default:break}};$(e).bind("input propertychange",function(){C(a,e,t,i);C(s,e,t,i);C(r,e,t,i);C(o,e,t,i);C(m,e,t,i);C(b,e,t,i);C(y,e,t,i);C(_,e,t,i);C(x,e,t,i)})};var l=function(e,t,i){var n=$(e).val(),a=n.charAt(n.length-1),s=n.substring(0,n.length-1),r="Il faut entrer un nombre entier positif";if(/[0-9]/.test(a)){if(/0/.test(s)&&s.length==1){$(e).val(a)}$(t).css("display","none")}else if(/,/.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/\./.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/-/.test(a)){$(i).text(r);$(t).css("display","block");$(e).val(n.substring(0,n.length-1))}else{$(e).val(s);$(i).text("Il faut entrer un chiffre");$(t).css("display","block")}};var d=function(e,t,i){var n=$(e).val(),a=n.charAt(n.length-1),s=n.substring(0,n.length-1),r="Il faut entrer un nombre entier";if(/[0-9]/.test(a)){if(/0/.test(s)&&s.length==1){$(e).val(a)}if(/-0/.test(s)&&s.length==2){$(e).val("-"+a)}$(t).css("display","none")}else if(/,/.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/\./.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/-/.test(a)){if(n.length>1){$(e).val(n.substring(0,n.length-1))}else{$(t).css("display","none")}}else if(n.length===0){$(i).text("Il faut entrer un nombre");$(t).css("display","block")}else{$(e).val(s);$(i).text("Il faut entrer un chiffre");$(t).css("display","block")}};var c=function(e,t,i){var n=$(e).val(),a=n.charAt(n.length-1),s=n.substring(0,n.length-1),r="Il faut entrer un nombre entier";if(/[0-9]/.test(a)){if(/0/.test(s)&&s.length==1){$(e).val(a)}if(/-0/.test(s)&&s.length==2){$(e).val("-"+a)}$(t).css("display","none")}else if(/,/.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/\./.test(a)){$(e).val(n.substring(0,n.length-1));$(i).text(r);$(t).css("display","block")}else if(/-/.test(a)){if(n.length>1){$(e).val(n.substring(0,n.length-1))}else{$(t).css("display","none")}}else if(n.length==0){$(i).text("Il faut entrer un nombre");$(t).css("display","block")}else{$(e).val(s);$(i).text("Il faut entrer un chiffre");$(t).css("display","block")}};var u=function(e,t,i){var n=$(e).val(),a=n.charAt(n.length-1),s=n.substring(0,n.length-1);if(/[0-9]/.test(a)){if(/0/.test(s)&&s.length==1){$(e).val(a)}if(/-0/.test(s)&&s.length==2){$(e).val("-"+a)}$(t).css("display","none")}else if(/,/.test(a)){if(/,/.test(s.substring(0,n.length-1))){$(e).val(n.substring(0,n.length-1))}}else if(/\./.test(a)){if(/,/.test(s.substring(0,n.length-1))){$(e).val(n.substring(0,n.length-1))}}else if(/-/.test(a)){if(n.length>1){$(e).val(n.substring(0,n.length-1))}else{$(t).css("display","none")}}else if(n.length==0){$(i).text("Il faut entrer un nombre");$(t).css("display","block")}else{$(e).val(s);$(i).text("Il faut entrer un chiffre");$(t).css("display","block")}};var h=function(e,t,i){var n=$(e).val(),a=n.charAt(n.length-1),s=n.substring(0,n.length-1);if(/[0-9]/.test(a)){if(/0/.test(s)&&s.length==1){$(e).val(a)}if(/-0/.test(s)&&s.length==2){$(e).val("-"+a)}$(t).css("display","none")}else if(/,/.test(a)){if(/,/.test(s.substring(0,n.length-1))){$(e).val(n.substring(0,n.length-1))}}else if(/\./.test(a)){if(/,/.test(s.substring(0,n.length-1))){$(e).val(n.substring(0,n.length-1))}}else if(/-/.test(a)){if(n.length>1){$(e).val(n.substring(0,n.length-1))}else{$(t).css("display","none")}}else if(n.length==0){$(i).text("Il faut entrer un nombre");$(t).css("display","block")}else{$(e).val(s);$(i).text("Il faut entrer un chiffre");$(t).css("display","block")}};var f=function(e){var t=$(e).val(),i=t.charAt(t.length-1),n=t.substring(0,t.length-1);if(/,/.test(i)){if(/,/.test(n.substring(0,t.length-1))){$(e).val(t.substring(0,t.length-1))}}if(/\./.test(i)){if(/,/.test(n)){$(e).val(n.substring(0,n.length-1))}else{$(e).val(t.substring(0,t.length-1).concat(","))}}};var p=function(e){var t=$(e).val(),i=t.charAt(t.length-1),n=t.substring(0,t.length-1);if(/-/.test(n)&&/^\./.test(i)){$(e).val("-0.")}if(/^\./.test(t)){$(e).val("0.")}};var v=function(e){var t=$(e).val(),i=t.charAt(t.length-1),n=t.substring(0,t.length-1);if(/-/.test(n)&&/^,/.test(i)){$(e).val("-0,")}if(/^,/.test(t)){$(e).val("0,")}};var g=function(e){var t=$(e).val(),i=t.charAt(t.length-1),n=t.substring(0,t.length-1);if(/-/.test(n)&&/^\./.test(i)){$(e).val("-0,")}if(/^\./.test(t)){$(e).val("0,")}};var m=function(i,r){_.defaults(i,{validation:{type:"integer",mode:"lock"},operation:"x1",left:[1],right:[1],shuffle:false});e=i;t=r;s=i.shuffle;a=[];n={left:[],right:[]};_.each(e.right,function(e,t){a.push({position:"right",originalposition:t,value:e})});_.each(e.left,function(e,t){a.push({position:"left",originalposition:t,value:e})});if(s)a=_.shuffle(a);b()};var b=function(){t.addClass("blackbox");t.append($('<div class="row header"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">x</p></div><div class="col-xs-2 operation"></div><div class="col-xs-2"><p class="text-center">y</p></div></div>'));$(".header",t).hide();_.each(a,function(i,n){if(i.position=="left"){t.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">'+i.value+'</p></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><input type="text" class="rpnm_input form-control" style="text-align: center;"></div></div>'))}else{t.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><input type="text" class="rpnm_input form-control" style="text-align: center;"></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><p class="text-center">'+i.value+"</p></div></div>"))}});r=$("<button>",{"data-toggle":"button","class":"btn btn-link btn-xs",text:" "+rpnsequence.getLabels().BlackboxTableView}).prepend($('<i class="glyphicon glyphicon-resize-small"></i>'));t.append($('<p class="text-center"></p>').append(r));i=rpnsequence.genericValidateButton();t.append(i);x()};var y=function(){$(".operation",t).slideToggle();$(".header",t).slideToggle()};var x=function(){r.click(function(){var e=$(this),t=this.lastChild;e.find("i").toggleClass("glyphicon-resize-small glyphicon-resize-full");t.nodeValue=" ";t.nodeValue=" "+(e.hasClass("showArchieved")?rpnsequence.getLabels().BlackboxTableView:rpnsequence.getLabels().BlackboxView);e.toggleClass("showArchieved");y()});i.click(function(){$.each($(".rpnm_input",t),function(e,t){var i=a[e];n[i.position][i.originalposition]=$(t).val()});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t.right,function(t,n){i+=e.right[n]==t?1:0});_.each(t.left,function(t,n){i+=e.left[n]==t?1:0});return i})})};return{init:m}};var rpncardmazemodule=function(){var e;var t;var i;var n;var a;var s;var r;var o;var l;var d;var c=function(i,a){_.defaults(i,{mazewidth:6,mazeheight:4,cards:[{label:"label",clue:"clue"}]});e=i;s=e.mazeheight;r=e.mazewidth;t=a;n=[];u();o=[]};var u=function(){t.addClass("cardmaze");t.append($('<div class="row"><div class="container maze"></div></div>'));_.each(e.cards,function(e,i){$(".maze",t).append($('<div class="col-xs-2 nopadding"></div>').append($('<div class="card'+(e.start?" start selectable":"")+(e.end?" end":"")+'"><p>'+e.label+"</p><p>"+e.clue+"</p></div>").data("cardId",i)));if(e.start){a=i;l=i}if(e.end){d=i}});i=rpnsequence.genericValidateButton();t.append(i);h()};var h=function(){_.each($(".card"),function(e,t){$(e).click(function(){if($(e).hasClass("start")||$(e).hasClass("selectable")||$(e).hasClass("selected")){if((t==a&&$(e).hasClass("start")||t==a+r||t==a-r||t==a-1||t==a+1)&&!$(e).hasClass("selected")){o.push(e)}else if($(e).hasClass("selected")){o=o.slice(0,_.indexOf(o,e)+1)}a=t;$(".selected").removeClass("selected");$(".selectable").removeClass("selectable");$(".card").removeClass("fromtop frombottom fromleft fromright totop tobottom toleft toright");_.each(o,function(e,t){if(t>0){var i=$(e).data("cardId")-$(o[t-1]).data("cardId");if(i==r){$(e).addClass("fromtop")}else if(i==-r){$(e).addClass("frombottom")}else if(i==1){$(e).addClass("fromleft")}else if(i==-1){$(e).addClass("fromright")}}if(t<o.length-1){var i=$(e).data("cardId")-$(o[t+1]).data("cardId");if(i==-r){$(e).addClass("tobottom")}else if(i==r){$(e).addClass("totop")}else if(i==-1){$(e).addClass("toright")}else if(i==1){$(e).addClass("toleft")}}$(e).addClass("selected")});if(t!=d){if(!(t+r>r*s)){$($(".card")[t+r]).addClass("selectable")}if(!(t-r<0)){$($(".card")[t-r]).addClass("selectable")}if(t%r!=0){$($(".card")[t-1]).addClass("selectable")}if((t+1)%r!=0){$($(".card")[t+1]).addClass("selectable")}}}})});i.click(function(){if(!$(o[o.length-1]).hasClass("end")){rpnsequence.displayAlert(rpnsequence.getLabels().CardMazeNotEnded)}else{_.each(o,function(e,t){n[t]=$(e).data("cardId")});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})}})};return{init:c}};var rpnclockmodule=function(){var e;var t;var i;var n;var a=function(i,n){_.defaults(i,{random:true,hour:"10:10"});e=i;if(e.random){e.hour=Math.floor(Math.random()*24+1)+":"+Math.floor(Math.random()*59)}t=n;s()};var s=function(){t.addClass("clock");t.append($('<div id="rpnclock"></div>'));n=EduClock();n.init({},$("#rpnclock"));i=rpnsequence.genericValidateButton();t.append(i);r()};var r=function(){i.click(function(){var e=n.getCurrentTime();rpnsequence.handleEndOfModule(e.hour+":"+e.minute,function(e,t){return e==t?1:0})})};return{init:a}};var EduClock=function(){var e;var t;var i;var n;var a;var s=false;var r;var o;var l;var d;var c;var u;var h;var f;var p;var v;var g;var m;var b=function(i,n){_.defaults(i,{margin:10,marginnumbers:-30,fontheight:15,hour:10,minute:10});t=i;m=t.hour>12;e=n;p="nothing";y()};var y=function(){i=$("<canvas>",{style:"position: absolute; left: 0; top: 0; z-index: 0;"});n=$("<canvas>",{style:"position: absolute; left: 0; top: 0; z-index: 1;"});a=$("<canvas>",{style:"position: absolute; left: 0; top: 0; z-index: 2;"});e.append([i,n,a]);i=i[0];n=n[0];a=a[0];r=Math.min(e.width(),e.height());i.width=r;i.height=r;n.width=r;n.height=r;a.width=r;a.height=r;c=r/2-t.margin;u=c+t.marginnumbers;o=i.getContext("2d");l=n.getContext("2d");d=a.getContext("2d");d.translate(r/2,r/2);h=t.hour;f=t.minute;x();C();D()};var x=function(){l.save();l.font="15px Arial";l.lineWidth=3;l.beginPath();l.arc(r/2,r/2,r/2-t.margin,0,Math.PI*2,true);l.stroke();l.beginPath();l.arc(r/2,r/2,10,0,Math.PI*2,true);l.fill();l.fillStyle="#fff";l.beginPath();l.arc(r/2,r/2+c/2,c/4,0,Math.PI*2,true);l.fill();l.fillStyle="#000";var e=[1,2,3,4,5,6,7,8,9,10,11,12];var i=0;var a=0;l.font=t.fontheight+"px Arial";$.each(e,function(e,s){i=Math.PI/6*(s-3);a=l.measureText(s).width;l.fillText(s,n.width/2+Math.cos(i)*u-a/2,n.height/2+Math.sin(i)*u+t.fontheight/3)});l.translate(r/2,r/2);i=Math.PI/30;for(var s=1;s<=60;s++){var o=s%5==0;l.rotate(i);var d=o?8:2;var h=o?15:8;l.fillRect(c-h,-d/2,h,d)}l.translate(-r/2,-r/2);l.restore()};var C=function(){d.save();d.clearRect(-r/2,-r/2,r,r);v=(h*60+f)*.5%360*Math.PI/180-Math.PI/2;if(v<0){v+=2*Math.PI}g=f*6%360*Math.PI/180-Math.PI/2;if(g<0){g+=2*Math.PI}d.rotate(v);d.fillStyle="#000";d.fillRect(5,-4,c*.6,8);d.rotate(-v);d.fillStyle="#f00";d.rotate(g);d.fillRect(5,-2,c*.85,4);d.rotate(-g);d.restore();k()};var k=function(){var e=q();var t=e.hour*60+e.minute;var i=0;if(t>960&&t<1200){i=(1200-t)/2.4}if(t>240&&t<480){i=Math.abs((t-480)/2.4);i=100-i}if(t>=480&&t<=960){i=100}var n=w(new Color("ffffff"),new Color("428bca"),i);o.fillStyle=n.toRGB();o.fillRect(0,0,r,r)};var w=function(e,t,i){var n=i/100;var a=n*2-1;var s=e.toHSL().a-t.toHSL().a;var r=((a*s==-1?a:(a+s)/(1+a*s))+1)/2;var o=1-r;var l=[e.rgb[0]*r+t.rgb[0]*o,e.rgb[1]*r+t.rgb[1]*o,e.rgb[2]*r+t.rgb[2]*o];var d=e.alpha*n+t.alpha*(1-n);return new Color(l,d)};var M=function(e,t){var i=Math.atan2(t-r/2,e-r/2);if(i<0){i=i+2*Math.PI}return i};var P=function(e,i){p="nothing";var n=M(e,i);var a=Math.sqrt(Math.pow(i-r/2,2)+Math.pow(e-r/2,2));if(a<=r/2-t.margin){if(n>g-Math.PI/12&&n<g+Math.PI/12){p="minutes"}else if(n>v-Math.PI/6&&n<v+Math.PI/6){p="hours"}else{p="nothing"}}};var I=function(e,i){var n=Math.sqrt(Math.pow(i-r/2,2)+Math.pow(e-r/2,2));if(n<=r/2-t.margin){var a=M(e,i);a=a+Math.PI/2;if(a>2*Math.PI){a=a-2*Math.PI}if(p=="minutes"){var s=f;f=Math.round(30/Math.PI*a);if(f>=60){f=0}if(f<=15&&s>=45){h++}else if(f>=45&&s<=15){h--}if(h>11){console.log("currentHours:"+h+", PM:"+m);m=!m;h=0}else if(h<0){console.log("currentHours:"+h+", PM:"+m);m=!m;h=11}}else if(p=="hours"){var o=h;var l=Math.round(360/Math.PI*a);f=l%60;var d=Math.floor((l-f)/60);if(d==12){d=0}if(o<=11&&o>=9&&d>=0&&d<=3||o>=0&&o<=3&&d>=9&&d<=11){m=!m}h=d}C()}};var D=function(){$(a).on("mousedown",function(e){P(e.offsetX,e.offsetY);if(p!="nothing"){s=true}});$(a).on("mouseup",function(){s=false});$(a).on("mouseout",function(){s=false});$(a).on("mousemove",function(e){if(s&&p!="nothing"){I(e.offsetX,e.offsetY)}})};var q=function(){return{hour:h+(m?12:0),minute:f}};return{init:b,getCurrentTime:q}};var Color=function(e,t){if(Array.isArray(e)){this.rgb=e}else if(e.length==6){this.rgb=e.match(/.{2}/g).map(function(e){return parseInt(e,16)})}else{this.rgb=e.split("").map(function(e){return parseInt(e+e,16)})}this.alpha=typeof t==="number"?t:1};Color.prototype.type="Color";function toHex(e){return"#"+e.map(function(e){e=Math.min(Math.max(Math.round(e),0),255);return(e<16?"0":"")+e.toString(16)}).join("")}Color.prototype.luma=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,i=this.rgb[2]/255;e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4);i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4);return.2126*e+.7152*t+.0722*i};Color.prototype.toRGB=function(){return toHex(this.rgb)};Color.prototype.toHSL=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,i=this.rgb[2]/255,n=this.alpha;var a=Math.max(e,t,i),s=Math.min(e,t,i);var r,o,l=(a+s)/2,d=a-s;if(a===s){r=o=0}else{o=l>.5?d/(2-a-s):d/(a+s);switch(a){case e:r=(t-i)/d+(t<i?6:0);break;case t:r=(i-e)/d+2;break;case i:r=(e-t)/d+4;break}r/=6}return{h:r*360,s:o,l:l,a:n}};Color.prototype.toHSV=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,i=this.rgb[2]/255,n=this.alpha;var a=Math.max(e,t,i),s=Math.min(e,t,i);var r,o,l=a;var d=a-s;if(a===0){o=0}else{o=d/a}if(a===s){r=0}else{switch(a){case e:r=(t-i)/d+(t<i?6:0);break;case t:r=(i-e)/d+2;break;case i:r=(e-t)/d+4;break}r/=6}return{h:r*360,s:o,v:l,a:n}};Color.prototype.toARGB=function(){return toHex([this.alpha*255].concat(this.rgb))};Color.prototype.compare=function(e){return e.rgb&&e.rgb[0]===this.rgb[0]&&e.rgb[1]===this.rgb[1]&&e.rgb[2]===this.rgb[2]&&e.alpha===this.alpha?0:undefined};var rpndragdropsortingmodule=function(){var e;var t;var i;var n;var a=function(i,a){_.defaults(i,{todrag:["empty"],todrop:["empty too :'("]});e=i;t=a;n=[];s()};var s=function(){t.addClass("dragdropsorting");t.append($('<div class="row"><div class="container"><div class="col-md-2"><ul class="dragthis list-unstyled"></ul></div></div><div class="row"><div class="container" id="dropzonecontainer"></div></div>'));$.each(e.todrop,function(e,t){$("#dropzonecontainer").append($('<div class="col-md-2"><div class="droppable"><span class="lead">'+t+'</span><ul class="list-unstyled"></ul></div></div>'))});$(".droppable ul").sortable({group:"drop",onDrop:function(e,t,i){r();i(e)}});i=rpnsequence.genericValidateButton();t.append(i);o();r()};var r=function(){if($(".dragthis li").length==0&&e.todrag.length>0){var t=e.todrag.pop();$(".dragthis").append($('<li class="draggable">'+t+"</li>"));$(".dragthis").sortable({group:"drop",drop:false})}};var o=function(){i.click(function(){if(e.todrag.length>0){rpnsequence.displayAlert(rpnsequence.getLabels().DragDropNotEmpty)}else{_.each($(".droppable"),function(e,t){var i=[];$.each($(e).find("li"),function(e,t){i.push($(t).text())});n[$(e).find("lh").text()]=i});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.map(t,function(t,n){i+=_.intersection(e[n],t).length});return i})}})};return{init:a}};var rpngapfullmodule=function(){var e;var t;var i;var n=function(i,n){_.defaults(i,{sentence:"sentence not set!"});e=i;t=n;a()};var a=function(){t.addClass("gapfull");t.append($("<p>"+e.sentence+'</p><input type="text" id="gapfullresponse" class="rpnm_input form-control">'));$("input",t).val(e.sentence);i=rpnsequence.genericValidateButton();t.append(i);s()};var s=function(){i.click(function(){rpnsequence.handleEndOfModule($("input",t).val(),function(e,t){return e==t?1:0})})};return{init:n}};var rpngapsimplemodule=function(){var e;var t;var i;var n;var a;var s;var r=function(i,s){_.defaults(i,{tofill:"tofill not set!<b>Read</b> documentation please!"});e=i;a=!_.isUndefined(i.fillers);t=s;n=[];o()};var o=function(){t.addClass("gapsimple");var r=_.shuffle(["primary","success","info","warning","danger"]);if(a){var o=$('<div class="gapsimpleddtoolbar">');$.each(e.fillers,function(e,t){o.append($('<span class="draggable">'+t+"</span> "))});s=_.max(e.fillers,function(e){return e.length}).length;t.append(o.sortable({group:"drop",drop:false,itemSelector:"span",containerSelector:"div",placeholder:'<span class="placeholder"/>',onDragStart:function(e,t,i){if(!t.options.drop){e.clone().insertAfter(e)}else{$("<span>"+Array(s).join("_")+"</span>").insertAfter(e)}i(e)},onDrop:function(e,t,i,n){e.parent().empty().append(e);i(e)}}))}t.append($('<div id="sentences" class="form-inline">'+e.tofill+"</div>"));$.each($("#sentences b",t),function(e,t){n[e]=-1;var i=$(t);if(a){i.replaceWith($('<b class="gapsimpleddresponse">').append("<span>"+Array(s).join("_")+"</span>").sortable({group:"drop",itemSelector:"span",containerSelector:"b",vertical:false}))}else{i.replaceWith($('<input type="text" id="'+e+'" class="rpnm_input gapsimple form-control"> <strong>('+i.text()+")</strong>"))}});i=rpnsequence.genericValidateButton();t.append(i);l()};var l=function(){i.click(function(){if(a){_.each($(".gapsimpleddresponse",$("#sentences",t)),function(e,t){n[t]=$(".draggable",$(e)).text()})}else{$.each($(".gapsimple",t),function(e,t){n[e]=$(t).val()})}rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:r}};var rpnmarkermodule=function(){var e;var t;var i;var n;var a;var s=function(n,s){_.defaults(n,{markers:[],tomark:["fill tomark to feel good please!"]});e=n;t=s;i=-1;a=[];r()};var r=function(){t.addClass("marker");var s=$("<div>",{"class":"btn-group","data-toggle":"buttons"});var r=_.shuffle(["primary","success","info","warning","danger"]);s.append($('<label class="btn btn-default active"><input type="radio" name="options" id="option1" autocomplete="off" checked><i class="glyphicon glyphicon-pencil"></i> '+rpnsequence.getLabels().Eraser+"</label>").click(function(){i=-1}));$.each(e.markers,function(e,t){s.append($('<label class="btn btn-'+(r[e]||"default")+'"><input type="radio" name="options" id="option3" autocomplete="off"><i class="glyphicon glyphicon-pencil"></i> '+t+"</label>").click(function(){i=t}))});t.append(s);t.append($('<div id="sentences">'+e.tomark+"</div>"));$.each($("#sentences b",t),function(t,n){a[t]=-1;var s=$(n);s.css("cursor","pointer").click(function(){s.removeClass();if(i!=-1){s.addClass("marker-"+r[_.indexOf(e.markers,i)])}a[t]=i})});n=$("<button>",{"class":"btn btn-primary",text:" "+rpnsequence.getLabels().Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'));t.append(n);o()};var o=function(){n.click(function(){rpnsequence.handleEndOfModule(a,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:s}};var rpnmqcmodule=function(){var e;var t;var i;var n;var a=function(i,a){_.defaults(i,{questions:["No questions!"],answers:["As no answers"]});e=i;t=a;n=[];s()};var s=function(){t.addClass("mqc");var a=$("<ul>",{"class":"list-unstyled"});$.each(e.questions,function(t,i){n[t]=-1;var s=$("<li>");s.append($("<p>"+i+"</p>"));var r=$('<div class="btn-group" data-toggle="buttons">');$.each(e.answers,function(e,i){r.append($('<label class="btn btn-default"><input type="radio" name="question_'+t+'" id="answer_'+t+"_"+e+'" autocomplete="off">'+i+"</label>").click(function(){n[t]=i}));s.append(r)});a.append(s)});t.append(a);i=rpnsequence.genericValidateButton();t.append(i);r()};var r=function(){i.click(function(){rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:a}};var rpnsequence=function(){var e;var t;var i;var n;var a;var s;var r;var o;var l;var d;var c;var u;var h;var f;var p;var v={en:{Recall:"Recall",Order:"Order",Warning:"Warning",BeforeUnloadMsg:"Module running!",Wait:"Wait please...",Validate:"Validate",Eraser:"Eraser",DragDropNotEmpty:"There are still some items to sort!",CardMazeNotEnded:"You have not finished the maze!",Sources:"Sources",BlackboxTableView:"Values table",BlackboxView:"Blackbox"},fr:{Recall:"Rappel",Order:"Consignes",Warning:"Attention",BeforeUnloadMsg:"Exercice en cours!",Wait:"Veuillez patienter...",Validate:"Valider",Eraser:"Effaceur",DragDropNotEmpty:"Il y a encore des éléments à trier!",CardMazeNotEnded:"Vous n'avez pas terminé le labyrinthe!",Sources:"Sources",BlackboxTableView:"Tableau de valeurs",BlackboxView:"Boîte noire"}};var g;var m=function(i){if(_.isUndefined(i)){i={}}_.defaults(i,{sequrl:"seq.json",solurl:"sol.json",returnurl:"../",warnonexit:false,domelem:$("body"),onsequenceend:function(){},onmoduleend:function(){},mediapathformatter:function(e){return"medias/"+e},language:"en",debug:false,navigationEnabled:false});g=v[i.language];r=[];o=i.warnonexit;s=i.returnurl;a=i.solurl;p=i.debug;h=i.domelem;l=i.onsequenceend;d=i.onmoduleend;c=i.mediapathformatter;$.getJSON(i.sequrl,function(n){_.defaults(n,{title:"sequencetitle",modules:[]});
e=n;_.each(e.modules,function(e,t){e["status"]="init"});t=0;f=i.navigationEnabled&&e.modules.length>1;b()})};var b=function(){h.append($('<div class="container" id="rpnm"><div class="row page-header"><div class="col-md-8"><h1 id="rpnm_seq_title"></h1></div><div class="col-md-4"><nav id="rpnm_modulenav"><ul class="pagination pagination-sm"></ul></nav></div></div><div class="row"><div class="col-md-12"><h2 id="rpnm_title"></h2><h3 id="rpnm_context"></h3><h4 id="rpnm_directive"></h4></div></div><div class="row"><div id="rpnm_module_content" class="col-md-12"></div></div></div><div class="container"><div class="row"><div class="col-md-12"><em id="rpnm_source" class="pull-right"></em></div></div>'));h.append($('<div id="rpnm_recall_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-bell"></i> '+g.Recall+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_order_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-question-sign"></i> '+g.Order+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_alert_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-warning-sign"></i> '+g.Warning+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_wait_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+g.Wait+'</h4></div><div class="modal-body"><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><span class="sr-only">100% completed</span></div></div></div></div></div></div>'));$("#rpnm_seq_title").html(e.title);n=$("#rpnm_source");i=$("#rpnm_module_content");u=$("#rpnm_alert_modal");if(!f){$("#rpnm_modulenav").remove()}_.each(e.modules,function(n,a){var s=$('<div class="rpnm_instance" id="rpnm_inst_'+a+'">');i.append(s);if(n.type=="marker"){rpnmarkermodule().init(n,s)}else if(n.type=="mqc"){rpnmqcmodule().init(n,s)}else if(n.type=="gapsimple"){rpngapsimplemodule().init(n,s)}else if(n.type=="gapfull"){rpngapfullmodule().init(n,s)}else if(n.type=="clock"){rpnclockmodule().init(n,s)}else if(n.type=="blackbox"){rpnblackboxmodule().init(n,s)}else if(n.type=="dragdropsorting"){rpndragdropsortingmodule().init(n,s)}else if(n.type=="cardmaze"){rpncardmazemodule().init(n,s)}s.hide();if(f&&e.modules.length>1){$("#rpnm_modulenav ul").append($('<li><a href="#">'+(a+1)+"</a></li>").click(function(){t=a;y()}))}});if(o){$(window).bind("beforeunload",function(e){return g.BeforeUnloadMsg})}y()};var y=function(){$("#rpnm_wait_modal").modal("show");var i=e.modules[t];_.defaults(i,{title:"title"});$(".rpnm_instance").hide();var n=$("#rpnm_inst_"+t);C(i);D();if(f){$("#rpnm_modulenav ul li").removeClass("active");$($("#rpnm_modulenav ul li")[t]).addClass("active")}if(i.status!="ended"){n.show()}else{t=x();if(t>=0){y()}else{w()}}$("#rpnm_wait_modal").modal("hide")};var x=function(){var i=_.find(e.modules,function(e,i){return e.status!="ended"&&i>=t});var n=_.find(e.modules,function(e,i){return e.status!="ended"&&i<t});if(!_.isUndefined(i)){return _.indexOf(e.modules,i)}else if(!_.isUndefined(n)){return _.indexOf(e.modules,n)}else{return-1}};var C=function(e){$("#rpnm_title").show().html(e.title+' <button class="btn btn-default btn-sm  pull-right" href="#" id="rpnm_order_link" data-toggle="modal" data-target="#rpnm_order_modal"><i class="glyphicon glyphicon-question-sign"></i> '+g.Order+'</button><button class="btn btn-default btn-sm pull-right" id="rpnm_recall_link" data-toggle="modal" data-target="#rpnm_recall_modal"><i class="glyphicon glyphicon-bell"></i> '+g.Recall+"</button>");_.isUndefined(e.context)?$("#rpnm_context").hide():$("#rpnm_context").show().text(e.context);_.isUndefined(e.directive)?$("#rpnm_directive").hide():$("#rpnm_directive").show().text(e.directive);if(_.isUndefined(e.recall)){$("#rpnm_recall_link").hide()}else{$("#rpnm_recall_link").show();$("#rpnm_recall_modal .modal-body").html(e.recall)}if(_.isUndefined(e.order)){$("#rpnm_order_link").hide()}else{$("#rpnm_order_link").show();$("#rpnm_order_modal .modal-body").html(e.order)}n.html(_.isUndefined(e.sources)?"":g.Sources+": "+e.sources)};var k=function(i,n){I("End of module");r[t]={responses:i,correctionFct:n};e.modules[t].status="ended";if(f){$($("#rpnm_modulenav ul li")[t]).unbind("click").addClass("disabled")}$("#rpnm_wait_modal").modal("show");t=x();d(i);if(_.isUndefined(e.modules[t])){w()}else{y()}};var w=function(){I("End of sequence");l(r);$.getJSON(a,function(e){var t=0;_.each(e.solutions,function(e,i){t+=_.isUndefined(r[i])?0:r[i].correctionFct(r[i].responses,e)});I("Calculated total score for sequence "+t);if(o){$(window).unbind("beforeunload")}window.location=s})};var M=function(e){e=_.isUndefined(e)?g.Validate:e;return $("<button>",{"class":"btn btn-primary",text:" "+g.Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'))};var P=function(e,t){$("#rpnm_alert_modal .modal-body").text(e);u.modal();u.on("hidden.bs.modal",function(){if(!_.isUndefined(t)){t()}})};var I=function(e){if(p){console.log(e)}};var D=function(){_.each($("img:not(.rpnm-img, .rpnm-mediapath)"),function(e,t){var i=$(e);i.attr("src",c($(e).attr("src"))).addClass("rpnm-mediapath");if(i.is(".modal-body img")){i.addClass("img-responsive img-rounded")}})};var q=function(){return g};var V=function(e,t){_.defaults(t,{mode:"lock",type:"integer"});_.each(e,function(e,i){$(e).on("keyup change paste",function(){var i=$(e);i.val(i.val().trim());if(t.mode=="lock"){var n=i[0].selectionStart,a=i[0].selectionEnd;if(t.type="integer"){var s=/(\d+)/.exec(i.val());if(s==""||s==null){i.val("")}else{i.val(parseInt(s))}}i[0].setSelectionRange(n,a)}else if(t.mode=="display"){if(t.type="integer"){if(!$.isNumeric(i.val())){i.tooltip({title:"integer needed"});i.tooltip("show")}else{i.tooltip("destroy")}}}})})};return{init:m,buildUi:b,handleEndOfModule:k,genericValidateButton:M,displayAlert:P,log:I,getLabels:q,addvalidation:V}}();
//# sourceMappingURL=rpnmodule.0.0.2.min.js.map