function ClockSelector(e,t){var i={auto_dt:1e3,automate:true,background:"black",callback:function(){},color_border:"#fff",color_hour:"#fff",color_minute:"#aaa",draw_hour:null,draw_minute:null,draw_second:null,highlight:"#f93",manual:true,stroke_border:3,stroke_hour:2,stroke_minute:.75,scale_hour:.5,scale_border:.8,scale_minute:.65};for(var n in i){this[n]=t&&n in t?t[n]:i[n]}e=document.getElementById(e);this.size=Math.min(e.width,e.height);if(!this.size){var a=window.getComputedStyle(e);this.size=Math.min(parseInt(a.width),parseInt(a.height))}if(e.tagName!="CANVAS"){e.appendChild(document.createElement("canvas"));e=e.childNodes[e.childNodes.length-1];e.width=this.size;e.height=this.size}this.canvas=e;this.context=e.getContext("2d");this.dragging=false;this.time=null;this.color_mindef=this.color_minute;e.style.backgroundColor=this.background;ClockSelector.prototype.clockTime=function(){return this.time};ClockSelector.prototype.drawHand=function(e,t,i){var n=this.context;n.strokeStyle=e;n.fillStyle=e;n.lineWidth=t;n.beginPath();n.moveTo(0,0);n.lineTo(0,100*i);n.closePath();n.stroke();n.arc(0,0,t/2,0,2*Math.PI);n.fill()};ClockSelector.prototype.getCanvasOffset=function(){var e=[0,0];var t=this.canvas;while(t.offsetParent){e[0]+=t.offsetLeft;e[1]+=t.offsetTop;t=t.offsetParent}return e};ClockSelector.prototype.reset=function(){this.setTime(new Date);if(this.automate){this.timeout=setInterval(this.setTimeRecurring(),this.auto_dt)}};ClockSelector.prototype.setParam=function(e,t){if(e in this){this[e]=t}};ClockSelector.prototype.setTime=function(e){this.canvas.width=this.canvas.width;this.time=e;e=e.getTime()/1e3-e.getTimezoneOffset()*60;var t=this.context;var i=this.size/200;var n=e%60/30*Math.PI;var a=e%3600/1800*Math.PI;var s=e/(6*3600)*Math.PI;this.setTransform(t,n,i);if(this.draw_second){var o=this.draw_second;o(t)}this.setTransform(t,a,i);if(this.draw_minute){var o=this.draw_minute;o(t)}else{this.drawHand(this.color_minute,this.stroke_minute*2,this.scale_minute)}this.setTransform(t,s,i);if(this.draw_hour){var o=this.drawHour;o(t)}else{this.drawHand(this.color_hour,this.stroke_hour*2,this.scale_hour)}t.setTransform(i,0,0,i,100*i,100*i);t.strokeStyle=this.color_border;t.lineWidth=this.stroke_border*2;t.beginPath();t.arc(0,0,100*this.scale_border,0,2*Math.PI);t.stroke();t.closePath();if(this.callback){this.callback(this)}};ClockSelector.prototype.setTimeFromEvent=function(e){var t=this.getCanvasOffset();var i=e.pageX-t[0]-this.size/2;var n=this.size/2-(e.pageY-t[1]);if(i==0&&n==0){return}var a=Math.atan2(n,i);var s,o;if(this.drag_minute){var r=(75-a*30/Math.PI)%60;var l=this.time.getMinutes()+this.time.getSeconds()/60;s=this.time.getHours();o=r;if(r<l&&l-r<=30){}else if(r<l&&l-r>30){s+=1}else if(r>l&&r-l<=30){}else if(r>l&&r-l>30){s-=1}s=(s+24)%24}else{var d=3-a*6/Math.PI;var c=this.time.getHours()+this.time.getMinutes()/60+this.time.getSeconds()/3600;d+=d<c?24:0;if(d<c+6){s=d}else if(d<c+12){s=d-12}else if(d<c+18){s=d+12}else{s=d}s=(s+24)%24;o=((3-a*6/Math.PI)*60%60+60)%60}var u=new Date;u.setHours(s);u.setMinutes(o);u.setSeconds(((3-a*6/Math.PI)*3600%60+60)%60);this.setTime(u)};ClockSelector.prototype.setTimeRecurring=function(){var e=this;return function(){e.setTime(new Date)}};ClockSelector.prototype.setTransform=function(e,t,i){e.setTransform(-i*Math.cos(t),-i*Math.sin(t),i*Math.sin(t),-i*Math.cos(t),100*i,100*i)};ClockSelector.prototype.makeEndDrag=function(){var e=this;return function(){e.color_minute=e.color_mindef;e.dragging=false;e.setTime(e.clockTime())}};ClockSelector.prototype.makeSetTime=function(e){if(!this.manual){return}var t=this;return function(){var i=window.event;var n=t.getCanvasOffset();var a=i.pageX-n[0]-t.size/2;var s=t.size/2-(i.pageY-n[1]);if(t.manual){t.canvas.style.cursor=Math.sqrt(a*a+s*s)<=(t.size*t.scale_border+t.stroke_border)/2?"pointer":"default"}if(t.dragging!=e){if(e&&!t.dragging){var o=Math.atan2(a,s);var r=(o+2*Math.PI)*30/Math.PI;var l=[(r+57.5)%60,(r+2.5)%60];r=t.clockTime().getMinutes()+t.clockTime().getSeconds()/60;if(Math.sqrt(a*a+s*s)<t.size/2*t.scale_border&&(l[0]<r&&r<l[1]||r<l[0]&&l[1]<l[0]&&r<l[1]||l[0]<r&&l[1]<r&&l[1]<l[0])){if(t.color_minute!=t.highlight){t.color_minute=t.highlight;t.drag_minute=true;t.setTime(t.clockTime())}}else{if(t.color_minute!=t.color_mindef){t.color_minute=t.color_mindef;t.drag_minute=false;t.setTime(t.clockTime())}}}return}if(!t.dragging&&!e){if(t.timeout){clearTimeout(t.timeout);t.timeout=null}t.dragging=true}t.setTimeFromEvent(window.event)}};if(this.manual){this.canvas.onmousedown=this.makeSetTime(false);this.canvas.onmouseup=this.makeEndDrag();this.canvas.onmouseout=this.makeEndDrag();this.canvas.onmousemove=this.makeSetTime(true)}this.reset()}!function(e,t,i,n){var a,s={drag:true,drop:true,exclude:"",nested:true,vertical:true},o={afterMove:function(e,t,i){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(e,t){return true},onCancel:function(e,t,i,n){},onDrag:function(e,t,i,n){e.css(t)},onDragStart:function(t,i,n,a){t.css({height:t.height(),width:t.width()});t.addClass("dragged");e("body").addClass("dragging")},onDrop:function(t,i,n,a){t.removeClass("dragged").removeAttr("style");e("body").removeClass("dragging")},onMousedown:function(e,t,i){if(!i.target.nodeName.match(/^(input|select)$/i)){i.preventDefault();return true}},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(t,i,n){var a=e.extend({},t.data());if(n)return[i];else if(i[0]){a.children=i}delete a.subContainers;delete a.sortable;return a},tolerance:0},r={},l=0,d={left:0,top:0,bottom:0,right:0},a={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},c="subContainers";function u(e,t){var i=Math.max(0,e[0]-t[0],t[0]-e[1]),n=Math.max(0,e[2]-t[1],t[1]-e[3]);return i+n}function h(t,i,n,a){var s=t.length,o=a?"offset":"position";n=n||0;while(s--){var r=t[s].el?t[s].el:e(t[s]),l=r[o]();l.left+=parseInt(r.css("margin-left"),10);l.top+=parseInt(r.css("margin-top"),10);i[s]=[l.left-n,l.left+r.outerWidth()+n,l.top-n,l.top+r.outerHeight()+n]}}function p(e,t){var i=t.offset();return{left:e.left-i.left,top:e.top-i.top}}function f(e,t,i){t=[t.left,t.top];i=i&&[i.left,i.top];var n,a=e.length,s=[];while(a--){n=e[a];s[a]=[a,u(n,t),i&&u(n,i)]}s=s.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]});return s}function m(t){this.options=e.extend({},o,t);this.containers=[];if(!this.options.rootGroup){this.scrollProxy=e.proxy(this.scroll,this);this.dragProxy=e.proxy(this.drag,this);this.dropProxy=e.proxy(this.drop,this);this.placeholder=e(this.options.placeholder);if(!t.isValidTarget)this.options.isValidTarget=n}}m.get=function(e){if(!r[e.group]){if(e.group===n)e.group=l++;r[e.group]=new m(e)}return r[e.group]};m.prototype={dragInit:function(t,i){this.$document=e(i.el[0].ownerDocument);this.item=e(t.target).closest(this.options.itemSelector);this.itemContainer=i;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,o.onMousedown,t)){return}this.setPointer(t);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=true},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,o.onDragStart,e);this.item.before(this.placeholder);this.dragging=true}this.setPointer(e);this.options.onDrag(this.item,p(this.pointer,this.item.offsetParent()),o.onDrag,e);var t=e.pageX||e.originalEvent.pageX,i=e.pageY||e.originalEvent.pageY,n=this.sameResultBox,a=this.options.tolerance;if(!n||n.top-a>i||n.bottom+a<i||n.left-a>t||n.right+a<t)if(!this.searchValidTarget())this.placeholder.detach()},drop:function(e){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();else this.options.onCancel(this.item,this.itemContainer,o.onCancel,e);this.options.onDrop(this.item,this.getContainer(this.item),o.onDrop,e);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=n;this.dragging=false}},searchValidTarget:function(e,t){if(!e){e=this.relativePointer||this.pointer;t=this.lastRelativePointer||this.lastPointer}var i=f(this.getContainerDimensions(),e,t),a=i.length;while(a--){var s=i[a][0],o=i[a][1];if(!o||this.options.pullPlaceholder){var r=this.containers[s];if(!r.disabled){if(!this.$getOffsetParent()){var l=r.getItemOffsetParent();e=p(e,l);t=p(t,l)}if(r.searchValidTarget(e,t))return true}}}if(this.sameResultBox)this.sameResultBox=n},movePlaceholder:function(e,t,i,n){var a=this.lastAppendedItem;if(!n&&a&&a[0]===t[0])return;t[i](this.placeholder);this.lastAppendedItem=t;this.sameResultBox=n;this.options.afterMove(this.placeholder,e,t)},getContainerDimensions:function(){if(!this.containerDimensions)h(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent());return this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(i)},$getOffsetParent:function(){if(this.offsetParent===n){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup){while(e--){if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=false;break}}}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);if(this.$getOffsetParent()){var i=p(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=i}this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(e){var t=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(e){return{left:e.pageX||e.originalEvent.pageX,top:e.pageY||e.originalEvent.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){e.delayMet=true},this.options.delay)}},scroll:function(e){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t){var i=this,n=["drag","drop","scroll"];e.each(n,function(e,n){i.$document[t](a[n],i[n+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=n},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);var t=this.containers.length;while(t--){this.containers[t].traverse(e)}},_clearDimensions:function(){this.containerDimensions=n},_destroy:function(){r[this.options.group]=n}};function v(t,i){this.el=t;this.options=e.extend({},s,i);this.group=m.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var n=this.rootGroup.options.itemPath;this.target=n?this.el.find(n):this.el;this.target.on(a.start,this.handle,e.proxy(this.dragInit,this));if(this.options.drop)this.group.containers.push(this)}v.prototype={dragInit:function(e){var t=this.rootGroup;if(!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)){t.dragInit(e,this)}},isValidDrag:function(e){return e.which==1||e.type=="touchstart"&&e.originalEvent.touches.length==1},searchValidTarget:function(e,t){var i=f(this.getItemDimensions(),e,t),n=i.length,a=this.rootGroup,s=!a.options.isValidTarget||a.options.isValidTarget(a.item,this);if(!n&&s){a.movePlaceholder(this,this.target,"append");return true}else while(n--){var o=i[n][0],r=i[n][1];if(!r&&this.hasChildGroup(o)){var l=this.getContainerGroup(o).searchValidTarget(e,t);if(l)return true}else if(s){this.movePlaceholder(o,e);return true}}},movePlaceholder:function(t,i){var n=e(this.items[t]),a=this.itemDimensions[t],s="after",o=n.outerWidth(),r=n.outerHeight(),l=n.offset(),c={left:l.left,right:l.left+o,top:l.top,bottom:l.top+r};if(this.options.vertical){var u=(a[2]+a[3])/2,h=i.top<=u;if(h){s="before";c.bottom-=r/2}else c.top+=r/2}else{var p=(a[0]+a[1])/2,f=i.left<=p;if(f){s="before";c.right-=o/2}else c.left+=o/2}if(this.hasChildGroup(t))c=d;this.rootGroup.movePlaceholder(this,n,s,c)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();h(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;if(t.css("position")==="relative"||t.css("position")==="absolute"||t.css("position")==="fixed")e=t;else e=t.offsetParent();return e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var a=e.data(this.items[t],c);if(a===n){var s=this.$getChildren(this.items[t],"container");a=false;if(s[0]){var o=e.extend({},this.options,{rootGroup:this.rootGroup,group:l++});a=s[i](o).data(i).group}e.data(this.items[t],c,a)}return a},$getChildren:function(t,i){var n=this.rootGroup.options,a=n[i+"Path"],s=n[i+"Selector"];t=e(t);if(a)t=t.find(a);return t.children(s)},_serialize:function(t,i){var n=this,a=i?"item":"container",s=this.$getChildren(t,a).not(this.options.exclude).map(function(){return n._serialize(e(this),!i)}).get();return this.rootGroup.options.serialize(t,s,i)},traverse:function(t){e.each(this.items||[],function(i){var n=e.data(this,c);if(n)n.traverse(t)});t(this)},_clearDimensions:function(){this.itemDimensions=n},_destroy:function(){var t=this;this.target.off(a.start,this.handle);this.el.removeData(i);if(this.options.drop)this.group.containers=e.grep(this.group.containers,function(e){return e!=t});e.each(this.items||[],function(){e.removeData(this,c)})}};var g={enable:function(){this.traverse(function(e){e.disabled=false})},disable:function(){this.traverse(function(e){e.disabled=true})},serialize:function(){return this._serialize(this.el,true)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};e.extend(v.prototype,g);e.fn[i]=function(t){var a=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),o=s.data(i);if(o&&g[t])return g[t].apply(o,a)||this;else if(!o&&(t===n||typeof t==="object"))s.data(i,new v(s,t));return this})}}(jQuery,window,"sortable");var rpnblackboxmodule=function(){var e;var t;var i;var n;var a;var s;var o;var r=function(i,o){_.defaults(i,{inputtype:"number",operation:"x1",left:[1],right:[1],shuffle:false});e=i;t=o;s=i.shuffle;a=[];n={left:[],right:[]};_.each(e.right,function(e,t){a.push({position:"right",originalposition:t,value:e})});_.each(e.left,function(e,t){a.push({position:"left",originalposition:t,value:e})});if(s)a=_.shuffle(a);l()};var l=function(){t.addClass("blackbox");t.append($('<div class="row header"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">x</p></div><div class="col-xs-2 operation"></div><div class="col-xs-2"><p class="text-center">y</p></div></div>'));$(".header",t).hide();_.each(a,function(i,n){if(i.position=="left"){t.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">'+i.value+'</p></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><input type="text" id="'+n+'" class="rpnm_input form-control" style="text-align: center;"></div></div>'))}else{t.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><input type="text" id="'+n+'" class="rpnm_input form-control" style="text-align: center;"></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><p class="text-center">'+i.value+"</p></div></div>"))}});o=$("<button>",{"data-toggle":"button","class":"btn btn-link btn-xs",text:" "+rpnsequence.getLabels().BlackboxTableView}).prepend($('<i class="glyphicon glyphicon-resize-small"></i>'));t.append($('<p class="text-center"></p>').append(o));i=rpnsequence.genericValidateButton();t.append(i);c()};var d=function(){$(".operation",t).slideToggle();$(".header",t).slideToggle()};var c=function(){o.click(function(){var e=$(this),t=this.lastChild;e.find("i").toggleClass("glyphicon-resize-small glyphicon-resize-full");t.nodeValue=" ";t.nodeValue=" "+(e.hasClass("showArchieved")?rpnsequence.getLabels().BlackboxTableView:rpnsequence.getLabels().BlackboxView);e.toggleClass("showArchieved");d()});i.click(function(){$.each($(".rpnm_input",t),function(e,t){var i=a[e];n[i.position][i.originalposition]=$(t).val()});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t.right,function(t,n){i+=e.right[n]==t?1:0});_.each(t.left,function(t,n){i+=e.left[n]==t?1:0});return i})})};return{init:r}};var rpncardmazemodule=function(){var e;var t;var i;var n;var a;var s;var o;var r;var l;var d;var c=function(i,a){_.defaults(i,{mazewidth:6,mazeheight:4,cards:[{label:"label",clue:"clue"}]});e=i;s=e.mazeheight;o=e.mazewidth;t=a;n=[];u();r=[]};var u=function(){t.addClass("cardmaze");t.append($('<div class="row"><div class="container maze"></div></div>'));_.each(e.cards,function(e,i){$(".maze",t).append($('<div class="col-xs-2 nopadding"></div>').append($('<div class="card'+(e.start?" start selectable":"")+(e.end?" end":"")+'"><p>'+e.label+"</p><p>"+e.clue+"</p></div>").data("cardId",i)));if(e.start){a=i;l=i}if(e.end){d=i}});i=rpnsequence.genericValidateButton();t.append(i);h()};var h=function(){_.each($(".card"),function(e,t){$(e).click(function(){if($(e).hasClass("start")||$(e).hasClass("selectable")||$(e).hasClass("selected")){if((t==a&&$(e).hasClass("start")||t==a+o||t==a-o||t==a-1||t==a+1)&&!$(e).hasClass("selected")){r.push(e)}else if($(e).hasClass("selected")){r=r.slice(0,_.indexOf(r,e)+1)}a=t;$(".selected").removeClass("selected");$(".selectable").removeClass("selectable");$(".card").removeClass("fromtop frombottom fromleft fromright totop tobottom toleft toright");_.each(r,function(e,t){if(t>0){var i=$(e).data("cardId")-$(r[t-1]).data("cardId");if(i==o){$(e).addClass("fromtop")}else if(i==-o){$(e).addClass("frombottom")}else if(i==1){$(e).addClass("fromleft")}else if(i==-1){$(e).addClass("fromright")}}if(t<r.length-1){var i=$(e).data("cardId")-$(r[t+1]).data("cardId");if(i==-o){$(e).addClass("tobottom")}else if(i==o){$(e).addClass("totop")}else if(i==-1){$(e).addClass("toright")}else if(i==1){$(e).addClass("toleft")}}$(e).addClass("selected")});if(t!=d){if(!(t+o>o*s)){$($(".card")[t+o]).addClass("selectable")}if(!(t-o<0)){$($(".card")[t-o]).addClass("selectable")}if(t%o!=0){$($(".card")[t-1]).addClass("selectable")}if((t+1)%o!=0){$($(".card")[t+1]).addClass("selectable")}}}})});i.click(function(){if(!$(r[r.length-1]).hasClass("end")){rpnsequence.displayAlert(rpnsequence.getLabels().CardMazeNotEnded)}else{_.each(r,function(e,t){n[t]=$(e).data("cardId")});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})}})};return{init:c}};var rpnclockmodule=function(){var e;var t;var i;var n=function(i,n){e=i;t=n;a()};var a=function(){t.addClass("clock");t.append($('<div id="rpnclock"></div>'));new ClockSelector("rpnclock",{background:"white",color_hour:"#333",color_minute:"#666",color_border:"#eee",highlight:"#357ebd"});i=rpnsequence.genericValidateButton();t.append(i);s()};var s=function(){i.click(function(){rpnsequence.handleEndOfModule($("#gapfullresponse").val(),function(e,t){return e==t?1:0})})};return{init:n}};var rpndragdropsortingmodule=function(){var e;var t;var i;var n;var a=function(i,a){_.defaults(i,{todrag:["empty"],todrop:["empty too :'("]});e=i;t=a;n=[];s()};var s=function(){t.addClass("dragdropsorting");t.append($('<div class="row"><div class="container"><div class="col-md-2"><ul class="dragthis list-unstyled"></ul></div></div><div class="row"><div class="container" id="dropzonecontainer"></div></div>'));$.each(e.todrop,function(e,t){$("#dropzonecontainer").append($('<div class="col-md-2"><div class="droppable"><span class="lead">'+t+'</span><ul class="list-unstyled"></ul></div></div>'))});$(".droppable ul").sortable({group:"drop",onDrop:function(e,t,i){o();i(e)}});i=rpnsequence.genericValidateButton();t.append(i);r();o()};var o=function(){if($(".dragthis li").length==0&&e.todrag.length>0){var t=e.todrag.pop();$(".dragthis").append($('<li class="draggable">'+t+"</li>"));$(".dragthis").sortable({group:"drop",drop:false})}};var r=function(){i.click(function(){if(e.todrag.length>0){rpnsequence.displayAlert(rpnsequence.getLabels().DragDropNotEmpty)}else{_.each($(".droppable"),function(e,t){var i=[];$.each($(e).find("li"),function(e,t){i.push($(t).text())});n[$(e).find("lh").text()]=i});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.map(t,function(t,n){i+=_.intersection(e[n],t).length});return i})}})};return{init:a}};var rpngapfullmodule=function(){var e;var t;var i;var n=function(i,n){_.defaults(i,{sentence:"sentence not set!"});e=i;t=n;a()};var a=function(){t.addClass("gapfull");t.append($("<p>"+e.sentence+'</p><input type="text" id="gapfullresponse" class="rpnm_input form-control">'));$("input",t).val(e.sentence);i=rpnsequence.genericValidateButton();t.append(i);s()};var s=function(){i.click(function(){rpnsequence.handleEndOfModule($("input",t).val(),function(e,t){return e==t?1:0})})};return{init:n}};var rpngapsimplemodule=function(){var e;var t;var i;var n;var a=function(i,a){_.defaults(i,{tofill:"tofill not set!<b>Read</b> documentation please!"});e=i;t=a;n=[];s()};var s=function(){t.addClass("gapsimple");t.append($('<div id="sentences" class="form-inline">'+e.tofill+"</div>"));$.each($("#sentences b",t),function(e,t){n[e]=-1;var i=$(t);i.replaceWith($('<input type="text" id="'+e+'" class="rpnm_input gapsimple form-control"> <strong>('+i.text()+")</strong>"))});i=rpnsequence.genericValidateButton();t.append(i);o()};var o=function(){i.click(function(){$.each($(".gapsimple"),function(e,t){n[e]=$(t).val()});rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:a}};var rpnmarkermodule=function(){var e;var t;var i;var n;var a;var s=function(n,s){_.defaults(n,{markers:[],tomark:["fill tomark to feel good please!"]});e=n;t=s;i=-1;a=[];o()};var o=function(){t.addClass("marker");var s=$("<div>",{"class":"btn-group","data-toggle":"buttons"});var o=_.shuffle(["primary","success","info","warning","danger"]);s.append($('<label class="btn btn-default active"><input type="radio" name="options" id="option1" autocomplete="off" checked><i class="glyphicon glyphicon-pencil"></i> '+rpnsequence.getLabels().Eraser+"</label>").click(function(){i=-1}));$.each(e.markers,function(e,t){s.append($('<label class="btn btn-'+(o[e]||"default")+'"><input type="radio" name="options" id="option3" autocomplete="off"><i class="glyphicon glyphicon-pencil"></i> '+t.label+"</label>").click(function(){i=t.val}))});t.append(s);t.append($('<div id="sentences">'+e.tomark+"</div>"));$.each($("#sentences b",t),function(e,t){a[e]=-1;var n=$(t);n.css("cursor","pointer").click(function(){n.removeClass();if(i!=-1){n.addClass("marker-"+o[i])}a[e]=i})});n=$("<button>",{"class":"btn btn-primary",text:" "+rpnsequence.getLabels().Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'));t.append(n);r()};var r=function(){n.click(function(){rpnsequence.handleEndOfModule(a,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:s}};var rpnmqcmodule=function(){var e;var t;var i;var n;var a=function(i,a){_.defaults(i,{questions:["No questions!"],answers:["As no answers"]});e=i;t=a;n=[];s()};var s=function(){t.addClass("mqc");var a=$("<ul>",{"class":"list-unstyled"});$.each(e.questions,function(t,i){n[t]=-1;var s=$("<li>");s.append($("<p>"+i.label+"</p>"));var o=$('<div class="btn-group" data-toggle="buttons">');$.each(e.answers,function(e,i){o.append($('<label class="btn btn-default"><input type="radio" name="question_'+t+'" id="answer_'+t+"_"+e+'" autocomplete="off">'+i.label+"</label>").click(function(){n[t]=e}));s.append(o)});a.append(s)});t.append(a);i=rpnsequence.genericValidateButton();t.append(i);o()};var o=function(){i.click(function(){rpnsequence.handleEndOfModule(n,function(e,t){var i=0;_.each(t,function(t,n){i+=e[n]==t?1:0});return i})})};return{init:a}};var rpnsequence=function(){var e;var t;var i;var n;var a;var s;var o;var r;var l;var d;var c;var u;var h;var p;var f;var m={en:{Recall:"Recall",Order:"Order",Warning:"Warning",BeforeUnloadMsg:"Module running!",Wait:"Wait please...",Validate:"Validate",Eraser:"Eraser",DragDropNotEmpty:"There are still some items to sort!",CardMazeNotEnded:"You have not finished the maze!",Sources:"Sources",BlackboxTableView:"Values table",BlackboxView:"Blackbox"},fr:{Recall:"Rappel",Order:"Consignes",Warning:"Attention",BeforeUnloadMsg:"Exercice en cours!",Wait:"Veuillez patienter...",Validate:"Valider",Eraser:"Effaceur",DragDropNotEmpty:"Il y a encore des éléments à trier!",CardMazeNotEnded:"Vous n'avez pas terminé le labyrinthe!",Sources:"Sources",BlackboxTableView:"Tableau de valeurs",BlackboxView:"Boîte noire"}};var v;var g=function(i){if(_.isUndefined(i)){i={}}_.defaults(i,{sequrl:"seq.json",solurl:"sol.json",returnurl:"../",warnonexit:false,domelem:$("body"),onsequenceend:function(){},onmoduleend:function(){},mediapathformatter:function(e){return"medias/"+e},language:"en",debug:false,navigationEnabled:false});v=m[i.language];o=[];r=i.warnonexit;s=i.returnurl;a=i.solurl;f=i.debug;h=i.domelem;l=i.onsequenceend;d=i.onmoduleend;c=i.mediapathformatter;$.getJSON(i.sequrl,function(n){_.defaults(n,{title:"sequencetitle",modules:[]});e=n;_.each(e.modules,function(e,t){e["status"]="init"});t=0;p=i.navigationEnabled&&e.modules.length>1;b()})};var b=function(){h.append($('<div class="container" id="rpnm"><div class="row page-header"><div class="col-md-8"><h1 id="rpnm_seq_title"></h1></div><div class="col-md-4"><nav id="rpnm_modulenav"><ul class="pagination pagination-sm"></ul></nav></div></div><div class="row"><div class="col-md-12"><h2 id="rpnm_title"></h2><h3 id="rpnm_context"></h3><h4 id="rpnm_directive"></h4></div></div><div class="row"><div id="rpnm_module_content" class="col-md-12"></div></div></div><div class="container"><div class="row"><div class="col-md-12"><em id="rpnm_source" class="pull-right"></em></div></div>'));h.append($('<div id="rpnm_recall_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-bell"></i> '+v.Recall+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_order_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-question-sign"></i> '+v.Order+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_alert_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-warning-sign"></i> '+v.Warning+'</h4></div><div class="modal-body"></div></div></div></div>'));h.append($('<div id="rpnm_wait_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+v.Wait+'</h4></div><div class="modal-body"><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><span class="sr-only">100% completed</span></div></div></div></div></div></div>'));$("#rpnm_seq_title").html(e.title);n=$("#rpnm_source");i=$("#rpnm_module_content");u=$("#rpnm_alert_modal");if(!p){$("#rpnm_modulenav").remove()}_.each(e.modules,function(n,a){var s=$('<div class="rpnm_instance" id="rpnm_inst_'+a+'">');i.append(s);if(n.type=="marker"){rpnmarkermodule().init(n,s)}else if(n.type=="mqc"){rpnmqcmodule().init(n,s)}else if(n.type=="gapsimple"){rpngapsimplemodule().init(n,s)}else if(n.type=="gapfull"){rpngapfullmodule().init(n,s)}else if(n.type=="clock"){rpnclockmodule().init(n,s)}else if(n.type=="blackbox"){rpnblackboxmodule().init(n,s)}else if(n.type=="dragdropsorting"){rpndragdropsortingmodule().init(n,s)}else if(n.type=="cardmaze"){rpncardmazemodule().init(n,s)}s.hide();if(p&&e.modules.length>1){$("#rpnm_modulenav ul").append($('<li><a href="#">'+(a+1)+"</a></li>").click(function(){t=a;y()}))}});if(r){$(window).bind("beforeunload",function(e){return v.BeforeUnloadMsg})}y()};var y=function(){$("#rpnm_wait_modal").modal("show");var i=e.modules[t];_.defaults(i,{title:"title"});$(".rpnm_instance").hide();var n=$("#rpnm_inst_"+t);w(i);D();if(p){$("#rpnm_modulenav ul li").removeClass("active");$($("#rpnm_modulenav ul li")[t]).addClass("active")}if(i.status!="ended"){n.show()}else{t=k();if(t>=0){y()}else{x()}}$("#rpnm_wait_modal").modal("hide")};var k=function(){var i=_.find(e.modules,function(e,i){return e.status!="ended"&&i>=t});var n=_.find(e.modules,function(e,i){return e.status!="ended"&&i<t});if(!_.isUndefined(i)){return _.indexOf(e.modules,i)}else if(!_.isUndefined(n)){return _.indexOf(e.modules,n)}else{return-1}};var w=function(e){$("#rpnm_title").show().html(e.title+' <button class="btn btn-default btn-sm  pull-right" href="#" id="rpnm_order_link" data-toggle="modal" data-target="#rpnm_order_modal"><i class="glyphicon glyphicon-question-sign"></i> '+v.Order+'</button><button class="btn btn-default btn-sm pull-right" id="rpnm_recall_link" data-toggle="modal" data-target="#rpnm_recall_modal"><i class="glyphicon glyphicon-bell"></i> '+v.Recall+"</button>");_.isUndefined(e.context)?$("#rpnm_context").hide():$("#rpnm_context").show().text(e.context);_.isUndefined(e.directive)?$("#rpnm_directive").hide():$("#rpnm_directive").show().text(e.directive);if(_.isUndefined(e.recall)){$("#rpnm_recall_link").hide()}else{$("#rpnm_recall_link").show();$("#rpnm_recall_modal .modal-body").html(e.recall)}if(_.isUndefined(e.order)){$("#rpnm_order_link").hide()}else{$("#rpnm_order_link").show();$("#rpnm_order_modal .modal-body").html(e.order)}n.html(_.isUndefined(e.sources)?"":v.Sources+": "+e.sources)};var C=function(i,n){T("End of module");o[t]={responses:i,correctionFct:n};e.modules[t].status="ended";if(p){$($("#rpnm_modulenav ul li")[t]).unbind("click").addClass("disabled")}$("#rpnm_wait_modal").modal("show");t=k();d(i);if(_.isUndefined(e.modules[t])){x()}else{y()}};var x=function(){T("End of sequence");l(o);$.getJSON(a,function(e){var t=0;_.each(e.solutions,function(e,i){t+=_.isUndefined(o[i])?0:o[i].correctionFct(o[i].responses,e)});T("Calculated total score for sequence "+t);if(r){$(window).unbind("beforeunload")}window.location=s})};var P=function(e){e=_.isUndefined(e)?v.Validate:e;return $("<button>",{"class":"btn btn-primary",text:" "+v.Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'))};var M=function(e,t){$("#rpnm_alert_modal .modal-body").text(e);u.modal();u.on("hidden.bs.modal",function(){if(!_.isUndefined(t)){t()}})};var T=function(e){if(f){console.log(e)}};var D=function(){_.each($("img:not(.rpnm-img, .rpnm-mediapath)"),function(e,t){var i=$(e);
i.attr("src",c($(e).attr("src"))).addClass("rpnm-mediapath");if(i.is(".modal-body img")){i.addClass("img-responsive img-rounded")}})};var q=function(){return v};return{init:g,buildUi:b,handleEndOfModule:C,genericValidateButton:P,displayAlert:M,log:T,getLabels:q}}();
//# sourceMappingURL=rpnmodule.0.0.1.min.js.map