$(document).ready(function(){rpnmodule.init({moduleend:function(c){alert("module ended!"+c)}})});
var rpnmoduleLabels={en:{Recall:"Recall",Order:"Order",Warning:"Warning",BeforeUnloadMsg:"Module running!",Wait:"Wait please...",Validate:"Validate",Eraser:"Eraser"},fr:{Recall:"Rappel",Order:"Consignes",Warning:"Attention",BeforeUnloadMsg:"Exercice en cours!",Wait:"Veuillez patienter...",Validate:"Valider",Eraser:"Effaceur"}},rpnmoduleSelectedLabels,rpnmodule=function(){var c,e,d,g,b,a,h,f,l,p=function(){$("body").append($('<div class="container"><div class="row"><div class="col-md-12"><h1 id="sequenceTitle"></h1></div></div><div class="row"><div class="col-xs-8"><h2 id="moduleTitle"></h2><h3 id="moduleContext"></h3><h4 id="moduleDirective"></h4></div><div class="col-xs-4"><button class="btn btn-link" id="recallLink" data-toggle="modal" data-target="#recallModal">'+rpnmoduleSelectedLabels.Recall+
'</button> <button class="btn btn-link"  id="orderLink" data-toggle="modal" data-target="#orderModal">'+rpnmoduleSelectedLabels.Order+'</button></div></div><div class="row"><div id="mainContent" class="col-md-12"></div></div></div>'));$("body").append($('<div id="recallModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">'+
rpnmoduleSelectedLabels.Recall+'</h4></div><div class="modal-body" id="recallModalContent"></div></div></div></div>'));$("body").append($('<div id="orderModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">'+rpnmoduleSelectedLabels.Order+
'</h4></div><div class="modal-body" id="orderModalContent"></div></div></div></div>'));$("body").append($('<div id="alertModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">'+rpnmoduleSelectedLabels.Warning+'</h4></div><div class="modal-body" id="orderModalContent"></div></div></div></div>'));
$("body").append($('<div id="waitModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+rpnmoduleSelectedLabels.Wait+'</h4></div><div class="modal-body" id="orderModalContent"><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><span class="sr-only">100% completed</span></div></div></div></div></div></div>'));
$("#sequenceTitle").html(c.title);d=$("#mainContent");h&&$(window).bind("beforeunload",function(a){return rpnmoduleSelectedLabels.BeforeUnloadMsg});m()},m=function(){var a=c.modules[e];_.defaults(a,{title:"title"});d.empty();d.removeClass().addClass("col-md-12");$("#moduleTitle").show().text(a.title);_.isUndefined(a.context)?$("#moduleContext").hide():$("#moduleContext").show().text(a.context);_.isUndefined(a.directive)?$("#moduleDirective").hide():$("#moduleDirective").show().text(a.directive);$("#waitModal").modal("hide");
"marker"==a.type?rpnmarkermodule.init(a,d):"mqc"==a.type?rpnmqcmodule.init(a,d):"gapsimple"==a.type?rpngapsimplemodule.init(a,d):"gapfull"==a.type?rpngapfullmodule.init(a,d):"clock"==a.type?rpnclockmodule.init(a,d):"blackbox"==a.type?rpnblackboxmodule.init(a,d):"dragdropsorting"==a.type&&rpndragdropsortingmodule.init(a,d)},r=function(){f(a);$.getJSON(g,function(f){var c=0;_.each(f.solutions,function(f,b){c+=_.isUndefined(a[b])?0:a[b].correctionFct(a[b].responses,f)});h&&$(window).unbind("beforeunload");
window.location=b})};return{init:function(d){_.defaults(d,{sequrl:"seq.json",solurl:"sol.json",mediaurl:"medias",returnurl:"../",warnonexit:!1,onsequenceend:function(){},onmoduleend:function(){},language:"en"});rpnmoduleSelectedLabels=rpnmoduleLabels[d.language];a=[];h=d.warnonexit;b=d.returnurl;g=d.solurl;f=d.onsequenceend;l=d.onmoduleend;$.getJSON(d.sequrl,function(a){_.defaults(a,{title:"mqc",modules:[]});c=a;e=0;p()})},buildUi:p,handleEndOfModule:function(f,b){a[e]={responses:f,correctionFct:b};
$("#waitModal").modal("show");e++;l(f);_.isUndefined(c.modules[e])?r():m()},genericValidateButton:function(a){_.isUndefined(a);return $("<button>",{"class":"btn btn-primary",text:" "+rpnmoduleSelectedLabels.Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'))}}}(),rpnmarkermodule=function(){var c,e,d,g,b,a=function(){e.addClass("rpnmodule_marker");var a=$("<div>",{"class":"btn-group","data-toggle":"buttons"}),l=_.shuffle(["primary","success","info","warning","danger"]);a.append($('<label class="btn btn-default active"><input type="radio" name="options" id="option1" autocomplete="off" checked><i class="glyphicon glyphicon-pencil"></i> '+
rpnmoduleSelectedLabels.Eraser+"</label>").click(function(){d=-1}));$.each(c.markers,function(b,h){a.append($('<label class="btn btn-'+(l[b]||"default")+'"><input type="radio" name="options" id="option3" autocomplete="off"><i class="glyphicon glyphicon-pencil"></i> '+h.label+"</label>").click(function(){d=h.val}))});e.append(a);e.append($('<div id="sentences">'+c.tomark+"</div>"));$.each($("#sentences b"),function(a,f){b[a]=-1;var h=$(f);h.css("cursor","pointer").click(function(){h.removeClass();
-1!=d&&h.addClass("marker-"+l[d]);b[a]=d})});g=$("<button>",{"class":"btn btn-primary",text:" "+rpnmoduleSelectedLabels.Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'));e.append(g);h()},h=function(){g.click(function(){rpnmodule.handleEndOfModule(b,function(a,b){var h=0;_.each(b,function(b,c){h+=a[c]==b?1:0});return h})})};return{init:function(f,h){_.defaults(f,{markers:[],tomark:["fill tomark to feel good please!"]});c=f;e=h;d=-1;b=[];a()}}}(),rpnmqcmodule=function(){var c,e,d,g,b=
function(){e.addClass("rpnmodule_mqc");var b=$("<ul>",{"class":"list-unstyled"});$.each(c.questions,function(a,d){g[a]=-1;var e=$("<li>");e.append($("<p>"+d.label+"</p>"));var m=$('<div class="btn-group" data-toggle="buttons">');$.each(c.answers,function(b,h){m.append($('<label class="btn btn-default"><input type="radio" name="question_'+a+'" id="answer_'+a+"_"+b+'" autocomplete="off">'+h.label+"</label>").click(function(){g[a]=b}));e.append(m)});b.append(e)});e.append(b);d=rpnmodule.genericValidateButton();
e.append(d);a()},a=function(){d.click(function(){rpnmodule.handleEndOfModule(g,function(a,b){var c=0;_.each(b,function(b,f){c+=a[f]==b?1:0});return c})})};return{init:function(a,f){_.defaults(a,{questions:["No questions!"],answers:["As no answers"]});c=a;e=f;g=[];b()}}}(),rpngapsimplemodule=function(){var c,e,d,g,b=function(){e.addClass("rpnmodule_gapsimple");e.append($('<div id="sentences" class="form-inline">'+c.tofill+"</div>"));$.each($("#sentences b"),function(a,b){g[a]=-1;var c=$(b);c.replaceWith($('<input type="text" id="'+
a+'" class="rpnmodule-input gapsimple form-control"> <strong>('+c.text()+")</strong>"))});d=rpnmodule.genericValidateButton();e.append(d);a()},a=function(){d.click(function(){$.each($(".gapsimple"),function(a,b){g[a]=$(b).val()});rpnmodule.handleEndOfModule(g,function(a,b){var c=0;_.each(b,function(b,f){c+=a[f]==b?1:0});return c})})};return{init:function(a,f){_.defaults(a,{tofill:"tofill not set!<b>Read</b> documentation please!"});c=a;e=f;g=[];b()}}}(),rpngapfullmodule=function(){var c,e,d,g=function(){d.click(function(){rpnmodule.handleEndOfModule($("#gapfullresponse").val(),
function(b,a){return b==a?1:0})})};return{init:function(b,a){_.defaults(b,{sentence:"sentence not set!"});c=b;e=a;e.addClass("rpnmodule_gapfull");e.append($('<div id="sentences"><p>'+c.sentence+'</p><input type="text" id="gapfullresponse" class="rpnmodule-input form-control"></div>'));$("#gapfullresponse").val(c.sentence);d=rpnmodule.genericValidateButton();e.append(d);g()}}}(),rpnclockmodule=function(){var c,e,d=function(){e.click(function(){rpnmodule.handleEndOfModule($("#gapfullresponse").val(),
function(c,b){return c==b?1:0})})};return{init:function(g,b){c=b;c.addClass("rpnmodule_clock");c.append($('<div id="rpnclock"></div>'));new ClockSelector("rpnclock",{background:"white",color_hour:"#333",color_minute:"#666",color_border:"#eee",highlight:"#357ebd"});e=rpnmodule.genericValidateButton();c.append(e);d()}}}(),rpnblackboxmodule=function(){var c,e,d,g,b=function(){e.addClass("rpnmodule_blackbox");var b=$('<div class="blackbox">');e.append(b);$.each(c.left,function(a,d){b.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><span>'+
d+'</span></div><div class="col-xs-2 blackbox-fct"><i class="glyphicon glyphicon-minus"></i> ('+c.operation+') <i class="glyphicon glyphicon-arrow-right"></i></div><div class="col-xs-2"><input type="text" id="'+a+'" class="rpnmodule-input blackbox-left form-control" style="text-align: center;"></div></div>'))});$.each(c.right,function(a,d){b.append($('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><input type="text" id="'+a+'" class="rpnmodule-input blackbox-right form-control" style="text-align: center;"></div><div class="col-xs-2 blackbox-fct"><i class="glyphicon glyphicon-minus"></i> ('+
c.operation+') <i class="glyphicon glyphicon-arrow-right"></i></div><div class="col-xs-2"><span>'+d+"</span></div></div>"))});d=rpnmodule.genericValidateButton();e.append(d);a()},a=function(){d.click(function(){$.each($(".blackbox-left"),function(a,b){g.left[a]=$(b).val()});$.each($(".blackbox-right"),function(a,b){g.right[a]=$(b).val()});rpnmodule.handleEndOfModule(g,function(a,b){var c=0;_.each(b.right,function(b,f){c+=a.right[f]==b?1:0});_.each(b.left,function(b,f){c+=a.left[f]==b?1:0});return c})})};
return{init:function(a,f){_.defaults(a,{inputtype:"number",fct:"x1",left:[1],right:[1]});c=a;e=f;g={left:[],right:[]};b()}}}(),rpndragdropsortingmodule=function(){var c,e,d,g,b=function(){e.addClass("rpnmodule_dnds");e.append($('<div class="row"><div class="container"><div class="col-md-12"><ul id="dragthis" class="list-unstyled"></ul></div></div><div class="row"><div class="container" id="dropzonecontainer"></div></div>'));$.each(c.todrag,function(a,b){$("#dragthis").append("<li>"+b+"</li>")});$.each(c.todrop,
function(a,b){$("#dropzonecontainer").append($('<div class="col-md-2"><ul class="droppable list-unstyled"><lh>'+b+"</lh></ul></div>"))});$("ul.droppable").sortable({group:"no-drop"});$("#dragthis").sortable({group:"no-drop",drop:!1});d=rpnmodule.genericValidateButton();e.append(d);a()},a=function(){d.click(function(){$.each($(".blackbox-left"),function(a,b){g.left[a]=$(b).val()});$.each($(".blackbox-right"),function(a,b){g.right[a]=$(b).val()});rpnmodule.handleEndOfModule(g,function(a,b){var c=0;
_.each(b.right,function(b,f){c+=a.right[f]==b?1:0});_.each(b.left,function(b,f){c+=a.left[f]==b?1:0});return c})})};return{init:function(a,f){_.defaults(a,{todrag:["empty"],todrop:["empty too :'("]});c=a;e=f;g=[];b()}}}();
function ClockSelector(c,e){var d={auto_dt:1E3,automate:!0,background:"black",callback:function(){},color_border:"#fff",color_hour:"#fff",color_minute:"#aaa",draw_hour:null,draw_minute:null,draw_second:null,highlight:"#f93",manual:!0,stroke_border:3,stroke_hour:2,stroke_minute:0.75,scale_hour:0.5,scale_border:0.8,scale_minute:0.65},g;for(g in d)this[g]=e&&g in e?e[g]:d[g];c=document.getElementById(c);this.size=Math.min(c.width,c.height);this.size||(d=window.getComputedStyle(c),this.size=Math.min(parseInt(d.width),
parseInt(d.height)));"CANVAS"!=c.tagName&&(c.appendChild(document.createElement("canvas")),c=c.childNodes[c.childNodes.length-1],c.width=this.size,c.height=this.size);this.canvas=c;this.context=c.getContext("2d");this.dragging=!1;this.time=null;this.color_mindef=this.color_minute;c.style.backgroundColor=this.background;ClockSelector.prototype.clockTime=function(){return this.time};ClockSelector.prototype.drawHand=function(b,a,c){var f=this.context;f.strokeStyle=b;f.fillStyle=b;f.lineWidth=a;f.beginPath();
f.moveTo(0,0);f.lineTo(0,100*c);f.closePath();f.stroke();f.arc(0,0,a/2,0,2*Math.PI);f.fill()};ClockSelector.prototype.getCanvasOffset=function(){for(var b=[0,0],a=this.canvas;a.offsetParent;)b[0]+=a.offsetLeft,b[1]+=a.offsetTop,a=a.offsetParent;return b};ClockSelector.prototype.reset=function(){this.setTime(new Date);this.automate&&(this.timeout=setInterval(this.setTimeRecurring(),this.auto_dt))};ClockSelector.prototype.setParam=function(b,a){b in this&&(this[b]=a)};ClockSelector.prototype.setTime=
function(b){this.canvas.width=this.canvas.width;this.time=b;b=b.getTime()/1E3-60*b.getTimezoneOffset();var a=this.context,c=this.size/200,f=b%3600/1800*Math.PI,d=b/21600*Math.PI;this.setTransform(a,b%60/30*Math.PI,c);this.draw_second&&(b=this.draw_second,b(a));this.setTransform(a,f,c);this.draw_minute?(b=this.draw_minute,b(a)):this.drawHand(this.color_minute,2*this.stroke_minute,this.scale_minute);this.setTransform(a,d,c);this.draw_hour?(b=this.drawHour,b(a)):this.drawHand(this.color_hour,2*this.stroke_hour,
this.scale_hour);a.setTransform(c,0,0,c,100*c,100*c);a.strokeStyle=this.color_border;a.lineWidth=2*this.stroke_border;a.beginPath();a.arc(0,0,100*this.scale_border,0,2*Math.PI);a.stroke();a.closePath();this.callback&&this.callback(this)};ClockSelector.prototype.setTimeFromEvent=function(b){var a=this.getCanvasOffset(),c=b.pageX-a[0]-this.size/2;b=this.size/2-(b.pageY-a[1]);if(0!=c||0!=b){c=Math.atan2(b,c);if(this.drag_minute){var f=(75-30*c/Math.PI)%60,d=this.time.getMinutes()+this.time.getSeconds()/
60;b=this.time.getHours();a=f;f<d&&30>=d-f||(f<d&&30<d-f?b+=1:f>d&&30>=f-d||f>d&&30<f-d&&(b-=1));b=(b+24)%24}else b=3-6*c/Math.PI,a=this.time.getHours()+this.time.getMinutes()/60+this.time.getSeconds()/3600,b+=b<a?24:0,b=((b<a+6?b:b<a+12?b-12:b<a+18?b+12:b)+24)%24,a=(60*(3-6*c/Math.PI)%60+60)%60;f=new Date;f.setHours(b);f.setMinutes(a);f.setSeconds((3600*(3-6*c/Math.PI)%60+60)%60);this.setTime(f)}};ClockSelector.prototype.setTimeRecurring=function(){var b=this;return function(){b.setTime(new Date)}};
ClockSelector.prototype.setTransform=function(b,a,c){b.setTransform(-c*Math.cos(a),-c*Math.sin(a),c*Math.sin(a),-c*Math.cos(a),100*c,100*c)};ClockSelector.prototype.makeEndDrag=function(){var b=this;return function(){b.color_minute=b.color_mindef;b.dragging=!1;b.setTime(b.clockTime())}};ClockSelector.prototype.makeSetTime=function(b){if(this.manual){var a=this;return function(){var c=window.event,d=a.getCanvasOffset(),e=c.pageX-d[0]-a.size/2,c=a.size/2-(c.pageY-d[1]);a.manual&&(a.canvas.style.cursor=
Math.sqrt(e*e+c*c)<=(a.size*a.scale_border+a.stroke_border)/2?"pointer":"default");if(a.dragging!=b){if(b&&!a.dragging){var d=30*(Math.atan2(e,c)+2*Math.PI)/Math.PI,g=[(d+57.5)%60,(d+2.5)%60],d=a.clockTime().getMinutes()+a.clockTime().getSeconds()/60;Math.sqrt(e*e+c*c)<a.size/2*a.scale_border&&(g[0]<d&&d<g[1]||d<g[0]&&g[1]<g[0]&&d<g[1]||g[0]<d&&g[1]<d&&g[1]<g[0])?a.color_minute!=a.highlight&&(a.color_minute=a.highlight,a.drag_minute=!0,a.setTime(a.clockTime())):a.color_minute!=a.color_mindef&&(a.color_minute=
a.color_mindef,a.drag_minute=!1,a.setTime(a.clockTime()))}}else a.dragging||b||(a.timeout&&(clearTimeout(a.timeout),a.timeout=null),a.dragging=!0),a.setTimeFromEvent(window.event)}}};this.manual&&(this.canvas.onmousedown=this.makeSetTime(!1),this.canvas.onmouseup=this.makeEndDrag(),this.canvas.onmouseout=this.makeEndDrag(),this.canvas.onmousemove=this.makeSetTime(!0));this.reset()}
!function(c,e,d,g){function b(a,b){var c=Math.max(0,a[0]-b[0],b[0]-a[1]),d=Math.max(0,a[2]-b[1],b[1]-a[3]);return c+d}function a(a,b,d,f){var g=a.length;f=f?"offset":"position";for(d=d||0;g--;){var e=a[g].el?a[g].el:c(a[g]),h=e[f]();h.left+=parseInt(e.css("margin-left"),10);h.top+=parseInt(e.css("margin-top"),10);b[g]=[h.left-d,h.left+e.outerWidth()+d,h.top-d,h.top+e.outerHeight()+d]}}function h(a,b){var c=b.offset();return{left:a.left-c.left,top:a.top-c.top}}function f(a,c,d){c=[c.left,c.top];d=
d&&[d.left,d.top];for(var f,g=a.length,e=[];g--;)f=a[g],e[g]=[g,b(f,c),d&&b(f,d)];return e=e.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function l(a){this.options=c.extend({},n,a);this.containers=[];this.options.rootGroup||(this.scrollProxy=c.proxy(this.scroll,this),this.dragProxy=c.proxy(this.drag,this),this.dropProxy=c.proxy(this.drop,this),this.placeholder=c(this.options.placeholder),a.isValidTarget||(this.options.isValidTarget=g))}function p(a,b){this.el=a;this.options=c.extend({},
r,b);this.group=l.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var d=this.rootGroup.options.itemPath;this.target=d?this.el.find(d):this.el;this.target.on(m.start,this.handle,c.proxy(this.dragInit,this));this.options.drop&&this.group.containers.push(this)}var m,r={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},n={afterMove:function(a,b,c){},containerPath:"",containerSelector:"ol, ul",distance:0,
delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(a,b){return!0},onCancel:function(a,b,c,d){},onDrag:function(a,b,c,d){a.css(b)},onDragStart:function(a,b,d,f){a.css({height:a.height(),width:a.width()});a.addClass("dragged");c("body").addClass("dragging")},onDrop:function(a,b,d,f){a.removeClass("dragged").removeAttr("style");c("body").removeClass("dragging")},onMousedown:function(a,b,c){if(!c.target.nodeName.match(/^(input|select)$/i))return c.preventDefault(),!0},placeholder:'<li class="placeholder"/>',
pullPlaceholder:!0,serialize:function(a,b,d){a=c.extend({},a.data());if(d)return[b];b[0]&&(a.children=b);delete a.subContainers;delete a.sortable;return a},tolerance:0},q={},t=0,u={left:0,top:0,bottom:0,right:0};m={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"};l.get=function(a){q[a.group]||(a.group===g&&(a.group=t++),q[a.group]=new l(a));return q[a.group]};l.prototype=
{dragInit:function(a,b){this.$document=c(b.el[0].ownerDocument);this.item=c(a.target).closest(this.options.itemSelector);this.itemContainer=b;!this.item.is(this.options.exclude)&&this.options.onMousedown(this.item,n.onMousedown,a)&&(this.setPointer(a),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0)},drag:function(a){if(!this.dragging){if(!this.distanceMet(a)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,n.onDragStart,a);this.item.before(this.placeholder);
this.dragging=!0}this.setPointer(a);this.options.onDrag(this.item,h(this.pointer,this.item.offsetParent()),n.onDrag,a);var b=a.pageX||a.originalEvent.pageX;a=a.pageY||a.originalEvent.pageY;var c=this.sameResultBox,d=this.options.tolerance;if(!c||c.top-d>a||c.bottom+d<a||c.left-d>b||c.right+d<b)this.searchValidTarget()||this.placeholder.detach()},drop:function(a){this.toggleListeners("off");this.dragInitDone=!1;if(this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();
else this.options.onCancel(this.item,this.itemContainer,n.onCancel,a);this.options.onDrop(this.item,this.getContainer(this.item),n.onDrop,a);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=g;this.dragging=!1}},searchValidTarget:function(a,b){a||(a=this.relativePointer||this.pointer,b=this.lastRelativePointer||this.lastPointer);for(var c=f(this.getContainerDimensions(),a,b),d=c.length;d--;){var e=c[d][0];if(!c[d][1]||this.options.pullPlaceholder)if(e=this.containers[e],
!e.disabled){if(!this.$getOffsetParent()){var l=e.getItemOffsetParent();a=h(a,l);b=h(b,l)}if(e.searchValidTarget(a,b))return!0}}this.sameResultBox&&(this.sameResultBox=g)},movePlaceholder:function(a,b,c,d){var f=this.lastAppendedItem;if(d||!f||f[0]!==b[0])b[c](this.placeholder),this.lastAppendedItem=b,this.sameResultBox=d,this.options.afterMove(this.placeholder,a,b)},getContainerDimensions:function(){this.containerDimensions||a(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent());
return this.containerDimensions},getContainer:function(a){return a.closest(this.options.containerSelector).data(d)},$getOffsetParent:function(){if(this.offsetParent===g){var a=this.containers.length-1,b=this.containers[a].getItemOffsetParent();if(!this.options.rootGroup)for(;a--;)if(b[0]!=this.containers[a].getItemOffsetParent()[0]){b=!1;break}this.offsetParent=b}return this.offsetParent},setPointer:function(a){a=this.getPointer(a);if(this.$getOffsetParent()){var b=h(a,this.$getOffsetParent());this.lastRelativePointer=
this.relativePointer;this.relativePointer=b}this.lastPointer=this.pointer;this.pointer=a},distanceMet:function(a){a=this.getPointer(a);return Math.max(Math.abs(this.pointer.left-a.left),Math.abs(this.pointer.top-a.top))>=this.options.distance},getPointer:function(a){return{left:a.pageX||a.originalEvent.pageX,top:a.pageY||a.originalEvent.pageY}},setupDelayTimer:function(){var a=this;this.delayMet=!this.options.delay;this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){a.delayMet=
!0},this.options.delay))},scroll:function(a){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(a){var b=this;c.each(["drag","drop","scroll"],function(c,d){b.$document[a](m[d],b[d+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=g},clearDimensions:function(){this.traverse(function(a){a._clearDimensions()})},traverse:function(a){a(this);for(var b=this.containers.length;b--;)this.containers[b].traverse(a)},_clearDimensions:function(){this.containerDimensions=g},_destroy:function(){q[this.options.group]=
g}};p.prototype={dragInit:function(a){var b=this.rootGroup;!this.disabled&&(!b.dragInitDone&&this.options.drag&&this.isValidDrag(a))&&b.dragInit(a,this)},isValidDrag:function(a){return 1==a.which||"touchstart"==a.type&&1==a.originalEvent.touches.length},searchValidTarget:function(a,b){var c=f(this.getItemDimensions(),a,b),d=c.length,e=this.rootGroup,g=!e.options.isValidTarget||e.options.isValidTarget(e.item,this);if(!d&&g)return e.movePlaceholder(this,this.target,"append"),!0;for(;d--;)if(e=c[d][0],
!c[d][1]&&this.hasChildGroup(e)){if(this.getContainerGroup(e).searchValidTarget(a,b))return!0}else if(g)return this.movePlaceholder(e,a),!0},movePlaceholder:function(a,b){var d=c(this.items[a]),e=this.itemDimensions[a],f="after",g=d.outerWidth(),h=d.outerHeight(),k=d.offset(),k={left:k.left,right:k.left+g,top:k.top,bottom:k.top+h};this.options.vertical?b.top<=(e[2]+e[3])/2?(f="before",k.bottom-=h/2):k.top+=h/2:b.left<=(e[0]+e[1])/2?(f="before",k.right-=g/2):k.left+=g/2;this.hasChildGroup(a)&&(k=u);
this.rootGroup.movePlaceholder(this,d,f,k)},getItemDimensions:function(){this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get(),a(this.items,this.itemDimensions=[],this.options.tolerance));return this.itemDimensions},getItemOffsetParent:function(){var a=this.el;return"relative"===a.css("position")||"absolute"===a.css("position")||"fixed"===a.css("position")?a:a.offsetParent()},hasChildGroup:function(a){return this.options.nested&&this.getContainerGroup(a)},
getContainerGroup:function(a){var b=c.data(this.items[a],"subContainers");if(b===g){var e=this.$getChildren(this.items[a],"container"),b=!1;e[0]&&(b=c.extend({},this.options,{rootGroup:this.rootGroup,group:t++}),b=e[d](b).data(d).group);c.data(this.items[a],"subContainers",b)}return b},$getChildren:function(a,b){var d=this.rootGroup.options,e=d[b+"Path"],d=d[b+"Selector"];a=c(a);e&&(a=a.find(e));return a.children(d)},_serialize:function(a,b){var d=this,e=this.$getChildren(a,b?"item":"container").not(this.options.exclude).map(function(){return d._serialize(c(this),
!b)}).get();return this.rootGroup.options.serialize(a,e,b)},traverse:function(a){c.each(this.items||[],function(b){(b=c.data(this,"subContainers"))&&b.traverse(a)});a(this)},_clearDimensions:function(){this.itemDimensions=g},_destroy:function(){var a=this;this.target.off(m.start,this.handle);this.el.removeData(d);this.options.drop&&(this.group.containers=c.grep(this.group.containers,function(b){return b!=a}));c.each(this.items||[],function(){c.removeData(this,"subContainers")})}};var s={enable:function(){this.traverse(function(a){a.disabled=
!1})},disable:function(){this.traverse(function(a){a.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(a){a._clearDimensions()})},destroy:function(){this.traverse(function(a){a._destroy()})}};c.extend(p.prototype,s);c.fn[d]=function(a){var b=Array.prototype.slice.call(arguments,1);return this.map(function(){var e=c(this),f=e.data(d);if(f&&s[a])return s[a].apply(f,b)||this;f||a!==g&&"object"!==typeof a||e.data(d,new p(e,a));return this})}}(jQuery,
window,"sortable");
