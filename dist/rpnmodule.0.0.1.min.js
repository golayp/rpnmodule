function ClockSelector(e,t){var i={auto_dt:1e3,automate:!0,background:"black",callback:function(){},color_border:"#fff",color_hour:"#fff",color_minute:"#aaa",draw_hour:null,draw_minute:null,draw_second:null,highlight:"#f93",manual:!0,stroke_border:3,stroke_hour:2,stroke_minute:.75,scale_hour:.5,scale_border:.8,scale_minute:.65};for(var n in i)this[n]=t&&n in t?t[n]:i[n];if(e=document.getElementById(e),this.size=Math.min(e.width,e.height),!this.size){var o=window.getComputedStyle(e);this.size=Math.min(parseInt(o.width),parseInt(o.height))}"CANVAS"!=e.tagName&&(e.appendChild(document.createElement("canvas")),e=e.childNodes[e.childNodes.length-1],e.width=this.size,e.height=this.size),this.canvas=e,this.context=e.getContext("2d"),this.dragging=!1,this.time=null,this.color_mindef=this.color_minute,e.style.backgroundColor=this.background,ClockSelector.prototype.clockTime=function(){return this.time},ClockSelector.prototype.drawHand=function(e,t,i){var n=this.context;n.strokeStyle=e,n.fillStyle=e,n.lineWidth=t,n.beginPath(),n.moveTo(0,0),n.lineTo(0,100*i),n.closePath(),n.stroke(),n.arc(0,0,t/2,0,2*Math.PI),n.fill()},ClockSelector.prototype.getCanvasOffset=function(){for(var e=[0,0],t=this.canvas;t.offsetParent;)e[0]+=t.offsetLeft,e[1]+=t.offsetTop,t=t.offsetParent;return e},ClockSelector.prototype.reset=function(){this.setTime(new Date),this.automate&&(this.timeout=setInterval(this.setTimeRecurring(),this.auto_dt))},ClockSelector.prototype.setParam=function(e,t){e in this&&(this[e]=t)},ClockSelector.prototype.setTime=function(e){this.canvas.width=this.canvas.width,this.time=e,e=e.getTime()/1e3-60*e.getTimezoneOffset();var t=this.context,i=this.size/200,n=e%60/30*Math.PI,o=e%3600/1800*Math.PI,s=e/21600*Math.PI;if(this.setTransform(t,n,i),this.draw_second){var a=this.draw_second;a(t)}if(this.setTransform(t,o,i),this.draw_minute){var a=this.draw_minute;a(t)}else this.drawHand(this.color_minute,2*this.stroke_minute,this.scale_minute);if(this.setTransform(t,s,i),this.draw_hour){var a=this.drawHour;a(t)}else this.drawHand(this.color_hour,2*this.stroke_hour,this.scale_hour);t.setTransform(i,0,0,i,100*i,100*i),t.strokeStyle=this.color_border,t.lineWidth=2*this.stroke_border,t.beginPath(),t.arc(0,0,100*this.scale_border,0,2*Math.PI),t.stroke(),t.closePath(),this.callback&&this.callback(this)},ClockSelector.prototype.setTimeFromEvent=function(e){var t=this.getCanvasOffset(),i=e.pageX-t[0]-this.size/2,n=this.size/2-(e.pageY-t[1]);if(0!=i||0!=n){var o,s,a=Math.atan2(n,i);if(this.drag_minute){var r=(75-30*a/Math.PI)%60,l=this.time.getMinutes()+this.time.getSeconds()/60;o=this.time.getHours(),s=r,l>r&&30>=l-r||(l>r&&l-r>30?o+=1:r>l&&30>=r-l||r>l&&r-l>30&&(o-=1)),o=(o+24)%24}else{var d=3-6*a/Math.PI,c=this.time.getHours()+this.time.getMinutes()/60+this.time.getSeconds()/3600;d+=c>d?24:0,o=c+6>d?d:c+12>d?d-12:c+18>d?d+12:d,o=(o+24)%24,s=(60*(3-6*a/Math.PI)%60+60)%60}var u=new Date;u.setHours(o),u.setMinutes(s),u.setSeconds((3600*(3-6*a/Math.PI)%60+60)%60),this.setTime(u)}},ClockSelector.prototype.setTimeRecurring=function(){var e=this;return function(){e.setTime(new Date)}},ClockSelector.prototype.setTransform=function(e,t,i){e.setTransform(-i*Math.cos(t),-i*Math.sin(t),i*Math.sin(t),-i*Math.cos(t),100*i,100*i)},ClockSelector.prototype.makeEndDrag=function(){var e=this;return function(){e.color_minute=e.color_mindef,e.dragging=!1,e.setTime(e.clockTime())}},ClockSelector.prototype.makeSetTime=function(e){if(this.manual){var t=this;return function(){var i=window.event,n=t.getCanvasOffset(),o=i.pageX-n[0]-t.size/2,s=t.size/2-(i.pageY-n[1]);if(t.manual&&(t.canvas.style.cursor=Math.sqrt(o*o+s*s)<=(t.size*t.scale_border+t.stroke_border)/2?"pointer":"default"),t.dragging==e)t.dragging||e||(t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.dragging=!0),t.setTimeFromEvent(window.event);else if(e&&!t.dragging){var a=Math.atan2(o,s),r=30*(a+2*Math.PI)/Math.PI,l=[(r+57.5)%60,(r+2.5)%60];r=t.clockTime().getMinutes()+t.clockTime().getSeconds()/60,Math.sqrt(o*o+s*s)<t.size/2*t.scale_border&&(l[0]<r&&r<l[1]||r<l[0]&&l[1]<l[0]&&r<l[1]||l[0]<r&&l[1]<r&&l[1]<l[0])?t.color_minute!=t.highlight&&(t.color_minute=t.highlight,t.drag_minute=!0,t.setTime(t.clockTime())):t.color_minute!=t.color_mindef&&(t.color_minute=t.color_mindef,t.drag_minute=!1,t.setTime(t.clockTime()))}}}},this.manual&&(this.canvas.onmousedown=this.makeSetTime(!1),this.canvas.onmouseup=this.makeEndDrag(),this.canvas.onmouseout=this.makeEndDrag(),this.canvas.onmousemove=this.makeSetTime(!0)),this.reset()}var rpnsequence=function(){var e,t,i,n,o,s,a,r,l,d,c,u,h,p,m,f,g={en:{Recall:"Recall",Order:"Order",Warning:"Warning",BeforeUnloadMsg:"Module running!",Wait:"Wait please...",Validate:"Validate",Eraser:"Eraser",DragDropNotEmpty:"There are still some items to sort!",CardMazeNotEnded:"You have not finished the maze!",Sources:"Sources",BlackboxTableView:"Values table",BlackboxView:"Blackbox"},fr:{Recall:"Rappel",Order:"Consignes",Warning:"Attention",BeforeUnloadMsg:"Exercice en cours!",Wait:"Veuillez patienter...",Validate:"Valider",Eraser:"Effaceur",DragDropNotEmpty:"Il y a encore des éléments à trier!",CardMazeNotEnded:"Vous n'avez pas terminé le labyrinthe!",Sources:"Sources",BlackboxTableView:"Tableau de valeurs",BlackboxView:"Boîte noire"}},v=function(i){_.isUndefined(i)&&(i={}),_.defaults(i,{sequrl:"seq.json",solurl:"sol.json",returnurl:"../",warnonexit:!1,domelem:$("body"),onsequenceend:function(){},onmoduleend:function(){},mediapathformatter:function(e){return"medias/"+e},language:"en",debug:!1,navigationEnabled:!1}),f=g[i.language],a=[],r=i.warnonexit,s=i.returnurl,o=i.solurl,m=i.debug,h=i.domelem,l=i.onsequenceend,d=i.onmoduleend,c=i.mediapathformatter,$.getJSON(i.sequrl,function(n){_.defaults(n,{title:"sequencetitle",modules:[]}),e=n,_.each(e.modules,function(e){e.status="init"}),t=0,p=i.navigationEnabled&&e.modules.length>1,b()})},b=function(){h.append($('<div class="container" id="rpnm"><div class="row page-header"><div class="col-md-8"><h1 id="rpnm_seq_title"></h1></div><div class="col-md-4"><nav id="rpnm_modulenav"><ul class="pagination pagination-sm"></ul></nav></div></div><div class="row"><div class="col-md-12"><h2 id="rpnm_title"></h2><h3 id="rpnm_context"></h3><h4 id="rpnm_directive"></h4></div></div><div class="row"><div id="rpnm_module_content" class="col-md-12"></div></div></div><div class="container"><div class="row"><div class="col-md-12"><em id="rpnm_source" class="pull-right"></em></div></div>')),h.append($('<div id="rpnm_recall_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-bell"></i> '+f.Recall+'</h4></div><div class="modal-body"></div></div></div></div>')),h.append($('<div id="rpnm_order_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-question-sign"></i> '+f.Order+'</h4></div><div class="modal-body"></div></div></div></div>')),h.append($('<div id="rpnm_alert_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title"><i class="glyphicon glyphicon-warning-sign"></i> '+f.Warning+'</h4></div><div class="modal-body"></div></div></div></div>')),h.append($('<div id="rpnm_wait_modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+f.Wait+'</h4></div><div class="modal-body"><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><span class="sr-only">100% completed</span></div></div></div></div></div></div>')),$("#rpnm_seq_title").html(e.title),n=$("#rpnm_source"),i=$("#rpnm_module_content"),u=$("#rpnm_alert_modal"),p||$("#rpnm_modulenav").remove(),_.each(e.modules,function(n,o){var s=$('<div class="rpnm_instance" id="rpnm_inst_'+o+'">');i.append(s),"marker"==n.type?rpnmarkermodule().init(n,s):"mqc"==n.type?rpnmqcmodule().init(n,s):"gapsimple"==n.type?rpngapsimplemodule().init(n,s):"gapfull"==n.type?rpngapfullmodule().init(n,s):"clock"==n.type?rpnclockmodule().init(n,s):"blackbox"==n.type?rpnblackboxmodule().init(n,s):"dragdropsorting"==n.type?rpndragdropsortingmodule().init(n,s):"cardmaze"==n.type&&rpncardmazemodule().init(n,s),s.hide(),p&&e.modules.length>1&&$("#rpnm_modulenav ul").append($('<li><a href="#">'+(o+1)+"</a></li>").click(function(){t=o,y()}))}),r&&$(window).bind("beforeunload",function(){return f.BeforeUnloadMsg}),y()},y=function(){$("#rpnm_wait_modal").modal("show");var i=e.modules[t];_.defaults(i,{title:"title"}),$(".rpnm_instance").hide();var n=$("#rpnm_inst_"+t);x(i),D(),p&&($("#rpnm_modulenav ul li").removeClass("active"),$($("#rpnm_modulenav ul li")[t]).addClass("active")),"ended"!=i.status?n.show():(t=k(),t>=0?y():w()),$("#rpnm_wait_modal").modal("hide")},k=function(){var i=_.find(e.modules,function(e,i){return"ended"!=e.status&&i>=t}),n=_.find(e.modules,function(e,i){return"ended"!=e.status&&t>i});return _.isUndefined(i)?_.isUndefined(n)?-1:_.indexOf(e.modules,n):_.indexOf(e.modules,i)},x=function(e){$("#rpnm_title").show().html(e.title+' <button class="btn btn-default btn-sm  pull-right" href="#" id="rpnm_order_link" data-toggle="modal" data-target="#rpnm_order_modal"><i class="glyphicon glyphicon-question-sign"></i> '+f.Order+'</button><button class="btn btn-default btn-sm pull-right" id="rpnm_recall_link" data-toggle="modal" data-target="#rpnm_recall_modal"><i class="glyphicon glyphicon-bell"></i> '+f.Recall+"</button>"),_.isUndefined(e.context)?$("#rpnm_context").hide():$("#rpnm_context").show().text(e.context),_.isUndefined(e.directive)?$("#rpnm_directive").hide():$("#rpnm_directive").show().text(e.directive),_.isUndefined(e.recall)?$("#rpnm_recall_link").hide():($("#rpnm_recall_link").show(),$("#rpnm_recall_modal .modal-body").html(e.recall)),_.isUndefined(e.order)?$("#rpnm_order_link").hide():($("#rpnm_order_link").show(),$("#rpnm_order_modal .modal-body").html(e.order)),n.html(_.isUndefined(e.sources)?"":f.Sources+": "+e.sources)},C=function(i,n){T("End of module"),a[t]={responses:i,correctionFct:n},e.modules[t].status="ended",p&&$($("#rpnm_modulenav ul li")[t]).unbind("click").addClass("disabled"),$("#rpnm_wait_modal").modal("show"),t=k(),d(i),_.isUndefined(e.modules[t])?w():y()},w=function(){T("End of sequence"),l(a),$.getJSON(o,function(e){var t=0;_.each(e.solutions,function(e,i){t+=_.isUndefined(a[i])?0:a[i].correctionFct(a[i].responses,e)}),T("Calculated total score for sequence "+t),r&&$(window).unbind("beforeunload"),window.location=s})},P=function(e){return e=_.isUndefined(e)?f.Validate:e,$("<button>",{"class":"btn btn-primary",text:" "+f.Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>'))},M=function(e,t){$("#rpnm_alert_modal .modal-body").text(e),u.modal(),u.on("hidden.bs.modal",function(){_.isUndefined(t)||t()})},T=function(e){m&&console.log(e)},D=function(){_.each($("img:not(.rpnm-img, .rpnm-mediapath)"),function(e){var t=$(e);t.attr("src",c($(e).attr("src"))).addClass("rpnm-mediapath"),t.is(".modal-body img")&&t.addClass("img-responsive img-rounded")})},q=function(){return f};return{init:v,buildUi:b,handleEndOfModule:C,genericValidateButton:P,displayAlert:M,log:T,getLabels:q}}(),rpnmarkermodule=function(){var e,t,i,n,o,s=function(n,s){_.defaults(n,{markers:[],tomark:["fill tomark to feel good please!"]}),e=n,t=s,i=-1,o=[],a()},a=function(){t.addClass("marker");var s=$("<div>",{"class":"btn-group","data-toggle":"buttons"}),a=_.shuffle(["primary","success","info","warning","danger"]);s.append($('<label class="btn btn-default active"><input type="radio" name="options" id="option1" autocomplete="off" checked><i class="glyphicon glyphicon-pencil"></i> '+rpnsequence.getLabels().Eraser+"</label>").click(function(){i=-1})),$.each(e.markers,function(e,t){s.append($('<label class="btn btn-'+(a[e]||"default")+'"><input type="radio" name="options" id="option3" autocomplete="off"><i class="glyphicon glyphicon-pencil"></i> '+t.label+"</label>").click(function(){i=t.val}))}),t.append(s),t.append($('<div id="sentences">'+e.tomark+"</div>")),$.each($("#sentences b",t),function(e,t){o[e]=-1;var n=$(t);n.css("cursor","pointer").click(function(){n.removeClass(),-1!=i&&n.addClass("marker-"+a[i]),o[e]=i})}),n=$("<button>",{"class":"btn btn-primary",text:" "+rpnsequence.getLabels().Validate}).prepend($('<i class="glyphicon glyphicon-ok"></i>')),t.append(n),r()},r=function(){n.click(function(){rpnsequence.handleEndOfModule(o,function(e,t){var i=0;return _.each(t,function(t,n){i+=e[n]==t?1:0}),i})})};return{init:s}},rpnmqcmodule=function(){var e,t,i,n,o=function(i,o){_.defaults(i,{questions:["No questions!"],answers:["As no answers"]}),e=i,t=o,n=[],s()},s=function(){t.addClass("mqc");var o=$("<ul>",{"class":"list-unstyled"});$.each(e.questions,function(t,i){n[t]=-1;var s=$("<li>");s.append($("<p>"+i.label+"</p>"));var a=$('<div class="btn-group" data-toggle="buttons">');$.each(e.answers,function(e,i){a.append($('<label class="btn btn-default"><input type="radio" name="question_'+t+'" id="answer_'+t+"_"+e+'" autocomplete="off">'+i.label+"</label>").click(function(){n[t]=e})),s.append(a)}),o.append(s)}),t.append(o),i=rpnsequence.genericValidateButton(),t.append(i),a()},a=function(){i.click(function(){rpnsequence.handleEndOfModule(n,function(e,t){var i=0;return _.each(t,function(t,n){i+=e[n]==t?1:0}),i})})};return{init:o}},rpngapsimplemodule=function(){var e,t,i,n,o=function(i,o){_.defaults(i,{tofill:"tofill not set!<b>Read</b> documentation please!"}),e=i,t=o,n=[],s()},s=function(){t.addClass("gapsimple"),t.append($('<div id="sentences" class="form-inline">'+e.tofill+"</div>")),$.each($("#sentences b",t),function(e,t){n[e]=-1;var i=$(t);i.replaceWith($('<input type="text" id="'+e+'" class="rpnm_input gapsimple form-control"> <strong>('+i.text()+")</strong>"))}),i=rpnsequence.genericValidateButton(),t.append(i),a()},a=function(){i.click(function(){$.each($(".gapsimple"),function(e,t){n[e]=$(t).val()}),rpnsequence.handleEndOfModule(n,function(e,t){var i=0;return _.each(t,function(t,n){i+=e[n]==t?1:0}),i})})};return{init:o}},rpngapfullmodule=function(){var e,t,i,n=function(i,n){_.defaults(i,{sentence:"sentence not set!"}),e=i,t=n,o()},o=function(){t.addClass("gapfull"),t.append($("<p>"+e.sentence+'</p><input type="text" id="gapfullresponse" class="rpnm_input form-control">')),$("input",t).val(e.sentence),i=rpnsequence.genericValidateButton(),t.append(i),s()},s=function(){i.click(function(){rpnsequence.handleEndOfModule($("input",t).val(),function(e,t){return e==t?1:0})})};return{init:n}},rpnclockmodule=function(){var e,t,i,n=function(i,n){e=i,t=n,o()},o=function(){t.addClass("clock"),t.append($('<div id="rpnclock"></div>')),new ClockSelector("rpnclock",{background:"white",color_hour:"#333",color_minute:"#666",color_border:"#eee",highlight:"#357ebd"}),i=rpnsequence.genericValidateButton(),t.append(i),s()},s=function(){i.click(function(){rpnsequence.handleEndOfModule($("#gapfullresponse").val(),function(e,t){return e==t?1:0})})};return{init:n}},rpnblackboxmodule=function(){var e,t,i,n,o,s,a,r=function(i,a){_.defaults(i,{inputtype:"number",operation:"x1",left:[1],right:[1],shuffle:!1}),e=i,t=a,s=i.shuffle,o=[],n={left:[],right:[]},_.each(e.right,function(e,t){o.push({position:"right",originalposition:t,value:e})}),_.each(e.left,function(e,t){o.push({position:"left",originalposition:t,value:e})}),s&&(o=_.shuffle(o)),l()},l=function(){t.addClass("blackbox"),t.append($('<div class="row header"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">x</p></div><div class="col-xs-2 operation"></div><div class="col-xs-2"><p class="text-center">y</p></div></div>')),$(".header",t).hide(),_.each(o,function(i,n){t.append("left"==i.position?$('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><p class="text-center">'+i.value+'</p></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><input type="text" id="'+n+'" class="rpnm_input form-control" style="text-align: center;"></div></div>'):$('<div class="row"><div class="col-md-3 hidden-xs hidden-sm"></div><div class="col-xs-2"><input type="text" id="'+n+'" class="rpnm_input form-control" style="text-align: center;"></div><div class="col-xs-2 operation"><p class="text-center"><i class="glyphicon glyphicon-minus"></i>'+e.operation+'<i class="glyphicon glyphicon-arrow-right"></i></p></div><div class="col-xs-2"><p class="text-center">'+i.value+"</p></div></div>"))}),a=$("<button>",{"data-toggle":"button","class":"btn btn-link btn-xs",text:" "+rpnsequence.getLabels().BlackboxTableView}).prepend($('<i class="glyphicon glyphicon-resize-small"></i>')),t.append($('<p class="text-center"></p>').append(a)),i=rpnsequence.genericValidateButton(),t.append(i),c()},d=function(){$(".operation",t).slideToggle(),$(".header",t).slideToggle()},c=function(){a.click(function(){var e=$(this),t=this.lastChild;e.find("i").toggleClass("glyphicon-resize-small glyphicon-resize-full"),t.nodeValue=" ",t.nodeValue=" "+(e.hasClass("showArchieved")?rpnsequence.getLabels().BlackboxTableView:rpnsequence.getLabels().BlackboxView),e.toggleClass("showArchieved"),d()}),i.click(function(){$.each($(".rpnm_input",t),function(e,t){var i=o[e];n[i.position][i.originalposition]=$(t).val()}),rpnsequence.handleEndOfModule(n,function(e,t){var i=0;return _.each(t.right,function(t,n){i+=e.right[n]==t?1:0}),_.each(t.left,function(t,n){i+=e.left[n]==t?1:0}),i})})};return{init:r}},rpndragdropsortingmodule=function(){var e,t,i,n,o=function(i,o){_.defaults(i,{todrag:["empty"],todrop:["empty too :'("]}),e=i,t=o,n=[],s()},s=function(){t.addClass("dragdropsorting"),t.append($('<div class="row"><div class="container"><div class="col-md-12"><ul id="dragthis" class="list-unstyled"></ul></div></div><div class="row"><div class="container" id="dropzonecontainer"></div></div>')),$.each(e.todrop,function(e,t){$("#dropzonecontainer").append($('<div class="col-md-2"><ul class="droppable list-unstyled"><lh>'+t+"</lh></ul></div>"))}),$("ul.droppable").sortable({group:"no-drop",onDrop:function(){a()}}),i=rpnsequence.genericValidateButton(),t.append(i),r(),a()},a=function(){if(0==$("#dragthis li").length&&e.todrag.length>0){var t=e.todrag.pop();$("#dragthis").append($("<li>"+t+"</li>")),$("#dragthis").sortable({group:"no-drop",drop:!1})}},r=function(){i.click(function(){e.todrag.length>0?rpnsequence.displayAlert(rpnsequence.getLabels().DragDropNotEmpty):(_.each($(".droppable"),function(e){var t=[];$.each($(e).find("li"),function(e,i){t.push($(i).text())}),n[$(e).find("lh").text()]=t}),rpnsequence.handleEndOfModule(n,function(e,t){var i=0;return _.map(t,function(t,n){i+=_.intersection(e[n],t).length}),i}))})};return{init:o}},rpncardmazemodule=function(){var e,t,i,n,o,s,a,r,l,d,c=function(i,o){_.defaults(i,{mazewidth:6,mazeheight:4,cards:[{label:"label",clue:"clue"}]}),e=i,s=e.mazeheight,a=e.mazewidth,t=o,n=[],u(),r=[]},u=function(){t.addClass("cardmaze"),t.append($('<div class="row"><div class="container maze"></div></div>')),_.each(e.cards,function(e,i){$(".maze",t).append($('<div class="col-xs-2 nopadding"></div>').append($('<div class="card'+(e.start?" start selectable":"")+(e.end?" end":"")+'"><p>'+e.label+"</p><p>"+e.clue+"</p></div>").data("cardId",i))),e.start&&(o=i,l=i),e.end&&(d=i)}),i=rpnsequence.genericValidateButton(),t.append(i),h()},h=function(){_.each($(".card"),function(e,t){$(e).click(function(){($(e).hasClass("start")||$(e).hasClass("selectable")||$(e).hasClass("selected"))&&((t==o&&$(e).hasClass("start")||t==o+a||t==o-a||t==o-1||t==o+1)&&!$(e).hasClass("selected")?r.push(e):$(e).hasClass("selected")&&(r=r.slice(0,_.indexOf(r,e)+1)),o=t,$(".selected").removeClass("selected"),$(".selectable").removeClass("selectable"),$(".card").removeClass("fromtop frombottom fromleft fromright"),_.each(r,function(e,t){if(t>0){var i=$(e).data("cardId")-$(r[t-1]).data("cardId");i==a?$(e).addClass("fromtop"):i==-a?$(e).addClass("frombottom"):1==i?$(e).addClass("fromleft"):-1==i&&$(e).addClass("fromright")}$(e).addClass("selected")}),t!=d&&(t+a>a*s||$($(".card")[t+a]).addClass("selectable"),0>t-a||$($(".card")[t-a]).addClass("selectable"),t%a!=0&&$($(".card")[t-1]).addClass("selectable"),(t+1)%a!=0&&$($(".card")[t+1]).addClass("selectable")))})}),i.click(function(){$(r[r.length-1]).hasClass("end")?(_.each(r,function(e,t){n[t]=$(e).data("cardId")}),rpnsequence.handleEndOfModule(n,function(e,t){var i=0;return _.each(t,function(t,n){i+=e[n]==t?1:0}),i})):rpnsequence.displayAlert(rpnsequence.getLabels().CardMazeNotEnded)})};return{init:c}};!function(e,t,i,n){function o(e,t){var i=Math.max(0,e[0]-t[0],t[0]-e[1]),n=Math.max(0,e[2]-t[1],t[1]-e[3]);return i+n}function s(t,i,n,o){var s=t.length,a=o?"offset":"position";for(n=n||0;s--;){var r=t[s].el?t[s].el:e(t[s]),l=r[a]();l.left+=parseInt(r.css("margin-left"),10),l.top+=parseInt(r.css("margin-top"),10),i[s]=[l.left-n,l.left+r.outerWidth()+n,l.top-n,l.top+r.outerHeight()+n]}}function a(e,t){var i=t.offset();return{left:e.left-i.left,top:e.top-i.top}}function r(e,t,i){t=[t.left,t.top],i=i&&[i.left,i.top];for(var n,s=e.length,a=[];s--;)n=e[s],a[s]=[s,o(n,t),i&&o(n,i)];return a=a.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]})}function l(t){this.options=e.extend({},h,t),this.containers=[],this.options.rootGroup||(this.scrollProxy=e.proxy(this.scroll,this),this.dragProxy=e.proxy(this.drag,this),this.dropProxy=e.proxy(this.drop,this),this.placeholder=e(this.options.placeholder),t.isValidTarget||(this.options.isValidTarget=n))}function d(t,i){this.el=t,this.options=e.extend({},u,i),this.group=l.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var n=this.rootGroup.options.itemPath;this.target=n?this.el.find(n):this.el,this.target.on(c.start,this.handle,e.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var c,u={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},h={afterMove:function(){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(){return!0},onCancel:function(){},onDrag:function(e,t){e.css(t)},onDragStart:function(t){t.css({height:t.height(),width:t.width()}),t.addClass("dragged"),e("body").addClass("dragging")},onDrop:function(t){t.removeClass("dragged").removeAttr("style"),e("body").removeClass("dragging")},onMousedown:function(e,t,i){return i.target.nodeName.match(/^(input|select)$/i)?void 0:(i.preventDefault(),!0)},placeholder:'<li class="placeholder"/>',pullPlaceholder:!0,serialize:function(t,i,n){var o=e.extend({},t.data());return n?[i]:(i[0]&&(o.children=i),delete o.subContainers,delete o.sortable,o)},tolerance:0},p={},m=0,f={left:0,top:0,bottom:0,right:0},c={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},g="subContainers";l.get=function(e){return p[e.group]||(e.group===n&&(e.group=m++),p[e.group]=new l(e)),p[e.group]},l.prototype={dragInit:function(t,i){this.$document=e(i.el[0].ownerDocument),this.item=e(t.target).closest(this.options.itemSelector),this.itemContainer=i,!this.item.is(this.options.exclude)&&this.options.onMousedown(this.item,h.onMousedown,t)&&(this.setPointer(t),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0)},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,h.onDragStart,e),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(e),this.options.onDrag(this.item,a(this.pointer,this.item.offsetParent()),h.onDrag,e);var t=e.pageX||e.originalEvent.pageX,i=e.pageY||e.originalEvent.pageY,n=this.sameResultBox,o=this.options.tolerance;(!n||n.top-o>i||n.bottom+o<i||n.left-o>t||n.right+o<t)&&(this.searchValidTarget()||this.placeholder.detach())},drop:function(e){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,h.onCancel,e),this.options.onDrop(this.item,this.getContainer(this.item),h.onDrop,e),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=n,this.dragging=!1)},searchValidTarget:function(e,t){e||(e=this.relativePointer||this.pointer,t=this.lastRelativePointer||this.lastPointer);for(var i=r(this.getContainerDimensions(),e,t),o=i.length;o--;){var s=i[o][0],l=i[o][1];if(!l||this.options.pullPlaceholder){var d=this.containers[s];if(!d.disabled){if(!this.$getOffsetParent()){var c=d.getItemOffsetParent();e=a(e,c),t=a(t,c)}if(d.searchValidTarget(e,t))return!0}}}this.sameResultBox&&(this.sameResultBox=n)},movePlaceholder:function(e,t,i,n){var o=this.lastAppendedItem;(n||!o||o[0]!==t[0])&&(t[i](this.placeholder),this.lastAppendedItem=t,this.sameResultBox=n,this.options.afterMove(this.placeholder,e,t))},getContainerDimensions:function(){return this.containerDimensions||s(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(i)},$getOffsetParent:function(){if(this.offsetParent===n){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup)for(;e--;)if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=!1;break}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);if(this.$getOffsetParent()){var i=a(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=i}this.lastPointer=this.pointer,this.pointer=t},distanceMet:function(e){var t=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(e){return{left:e.pageX||e.originalEvent.pageX,top:e.pageY||e.originalEvent.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){e.delayMet=!0},this.options.delay))},scroll:function(){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(t){var i=this,n=["drag","drop","scroll"];e.each(n,function(e,n){i.$document[t](c[n],i[n+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=n},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);for(var t=this.containers.length;t--;)this.containers[t].traverse(e)},_clearDimensions:function(){this.containerDimensions=n},_destroy:function(){p[this.options.group]=n}},d.prototype={dragInit:function(e){var t=this.rootGroup;!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)&&t.dragInit(e,this)},isValidDrag:function(e){return 1==e.which||"touchstart"==e.type&&1==e.originalEvent.touches.length},searchValidTarget:function(e,t){var i=r(this.getItemDimensions(),e,t),n=i.length,o=this.rootGroup,s=!o.options.isValidTarget||o.options.isValidTarget(o.item,this);if(!n&&s)return o.movePlaceholder(this,this.target,"append"),!0;for(;n--;){var a=i[n][0],l=i[n][1];if(!l&&this.hasChildGroup(a)){var d=this.getContainerGroup(a).searchValidTarget(e,t);if(d)return!0}else if(s)return this.movePlaceholder(a,e),!0}},movePlaceholder:function(t,i){var n=e(this.items[t]),o=this.itemDimensions[t],s="after",a=n.outerWidth(),r=n.outerHeight(),l=n.offset(),d={left:l.left,right:l.left+a,top:l.top,bottom:l.top+r};if(this.options.vertical){var c=(o[2]+o[3])/2,u=i.top<=c;u?(s="before",d.bottom-=r/2):d.top+=r/2}else{var h=(o[0]+o[1])/2,p=i.left<=h;p?(s="before",d.right-=a/2):d.left+=a/2}this.hasChildGroup(t)&&(d=f),this.rootGroup.movePlaceholder(this,n,s,d)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get(),s(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;return e="relative"===t.css("position")||"absolute"===t.css("position")||"fixed"===t.css("position")?t:t.offsetParent()},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var o=e.data(this.items[t],g);if(o===n){var s=this.$getChildren(this.items[t],"container");if(o=!1,s[0]){var a=e.extend({},this.options,{rootGroup:this.rootGroup,group:m++});o=s[i](a).data(i).group}e.data(this.items[t],g,o)}return o},$getChildren:function(t,i){var n=this.rootGroup.options,o=n[i+"Path"],s=n[i+"Selector"];return t=e(t),o&&(t=t.find(o)),t.children(s)},_serialize:function(t,i){var n=this,o=i?"item":"container",s=this.$getChildren(t,o).not(this.options.exclude).map(function(){return n._serialize(e(this),!i)}).get();return this.rootGroup.options.serialize(t,s,i)},traverse:function(t){e.each(this.items||[],function(){var i=e.data(this,g);i&&i.traverse(t)}),t(this)},_clearDimensions:function(){this.itemDimensions=n},_destroy:function(){var t=this;this.target.off(c.start,this.handle),this.el.removeData(i),this.options.drop&&(this.group.containers=e.grep(this.group.containers,function(e){return e!=t})),e.each(this.items||[],function(){e.removeData(this,g)})}};var v={enable:function(){this.traverse(function(e){e.disabled=!1})},disable:function(){this.traverse(function(e){e.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};e.extend(d.prototype,v),e.fn[i]=function(t){var o=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),a=s.data(i);return a&&v[t]?v[t].apply(a,o)||this:(a||t!==n&&"object"!=typeof t||s.data(i,new d(s,t)),this)})}}(jQuery,window,"sortable");
//# sourceMappingURL=rpnmodule.0.0.1.min.js.map